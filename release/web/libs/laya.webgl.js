!function(d,a,y){y.un,y.uns;var s=y.static,l=y.class,o=y.getset,h=(y.__newvec,laya.maths.Bezier),r=laya.resource.Bitmap,u=laya.utils.Browser,p=(laya.filters.ColorFilter,laya.utils.ColorUtils),c=y.Config,w=laya.resource.Context,t=(laya.display.cmd.DrawImageCmd,laya.events.Event,laya.display.cmd.FillTextCmd,laya.filters.Filter),f=laya.utils.FontInfo,m=laya.resource.HTMLCanvas,e=(laya.utils.HTMLChar,laya.resource.HTMLImage),R=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),M=laya.maths.Point,S=laya.maths.Rectangle,C=laya.renders.Render,x=laya.renders.RenderSprite,i=laya.resource.Resource,n=(laya.display.cmd.RestoreCmd,laya.display.cmd.RotateCmd,laya.utils.RunDriver),_=(laya.display.cmd.SaveCmd,laya.display.cmd.ScaleCmd,laya.display.Sprite),v=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),g=laya.utils.Stat,T=laya.utils.StringKey,b=laya.system.System,A=(laya.display.Text,laya.resource.Texture),E=(laya.display.cmd.TransformCmd,laya.display.cmd.TranslateCmd,laya.utils.VectorGraphManager);laya.utils.WordText;y.interface("laya.webgl.submit.ISubmit"),y.interface("laya.webgl.canvas.save.ISaveData");var I=function(){function o(){}l(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;return y.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(o.POOL[o.POOL._length++]=this)._newSubmit&&(t._curSubmit=q.RENDERBASE)},o._createArray=function(){var t=[];return t._length=0,t},o._init=function(){var t=o._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},o.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var n=o.POOL,a=0<n._length?n[--n._length]:new o;a._value=i[a._valueName=o._namemap[e]],a._dataObj=i,a._newSubmit=r;var s=t._save;s[s._length++]=a}},o.POOL=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),P=function(){function r(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.defines=new Et,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=r._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=r._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}l(r,"laya.webgl.shader.d2.value.Value2D");var t=r.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return Ft.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Vt.create,this._attribLocation)},t.upload=function(){var t=ct;ct.worldMatrix4===ct.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4,ct.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=ct.matWVP.elements);var e=Ft.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+(J.shaderHighPrecision?1024:0)},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1)},r._initone=function(t,e){r._typeClass[t]=e,r._cache[t]=[],r._cache[t]._length=0},r.__init__=function(){r._initone(4,Tt),r._initone(512,vt),r._initone(1,gt),r._initone(9,gt)},r.create=function(t,e){var i=r._cache[t|e];return i._length?i[--i._length]:new r._typeClass[t|e](e)},r._cache=[],r._typeClass=[],r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r}(),D=function(){function t(){this.ib=null,this.vb=null;J.mainContext;this.ib=Bt.create(35048),this.vb=Ot.create(8)}l(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),B=function(){function n(){this._clipInfoID=-1,this._globalClipMatrix=new R,this._clipRect=new S}l(n,"laya.webgl.canvas.save.SaveClipRect");var t=n.prototype;return y.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,n.POOL[n.POOL._length++]=this},n.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=n.POOL,i=0<e._length?e[--e._length]:new n;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID;var r=t._save;r[r._length++]=i}},n.POOL=I._createArray(),n}(),O=function(){function t(){}l(t,"laya.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new at(this,t,e,i)},e.beginCommandEncoding=function(t){},e.endCommandEncoding=function(){},e.matrix4x4Multiply=function(t,e,i){},e.evaluateClipDatasRealTime=function(t,e,i,r){},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},t.createArrayBufferRef=function(t,e,i){},t.createArrayBufferRefs=function(t,e,i,r){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.ARRAY_BUFFER_TYPE_DATA=0,t.ARRAY_BUFFER_TYPE_CMD=1,t.ARRAY_BUFFER_REF_REFERENCE=0,t.ARRAY_BUFFER_REF_COPY=1,t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,t.instance=null,t}(),L=function(){function t(t,e,i){this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,void(this._used=0)===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this.atlasID=i,this._init(t,e)}l(t,"laya.webgl.text.AtlasGrid");var e=t.prototype;return e.addRect=function(t,e,i,r){return!!this._get(e,i,r)&&(this._fill(r.x,r.y,e,i,t),this._texCount++,!0)},e._release=function(){this._cells=null,this._rowInfo=null},e._init=function(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)},e._get=function(t,e,i){if(t>this._width||e>this._height)return!1;for(var r=-1,n=-1,a=this._width,s=this._height,o=this._cells,h=0;h<s;h++)if(!(this._rowInfo[h]<t))for(var l=0;l<a;){var u=3*(h*a+l);if(0!=o[u]||o[u+1]<t||o[u+2]<e)l+=o[u+1];else{r=l,n=h;for(var c=0;c<t;c++)if(o[3*c+u+2]<e){r=-1;break}if(!(r<0))return i.x=r,i.y=n,!0;l+=o[u+1]}}return!1},e._fill=function(t,e,i,r,n){var a=this._width,s=this._height;this._check(t+i<=a&&e+r<=s);for(var o=e;o<r+e;++o){this._check(this._rowInfo[o]>=i),this._rowInfo[o]-=i;for(var h=0;h<i;h++){var l=3*(t+o*a+h);this._check(0==this._cells[l]),this._cells[l]=n,this._cells[l+1]=i,this._cells[l+2]=r}}if(0<t)for(o=0;o<r;++o){var u=0;for(h=t-1;0<=h&&0==this._cells[3*((e+o)*a+h)];--h,++u);for(h=u;0<h;--h)this._cells[3*((e+o)*a+t-h)+1]=h,this._check(0<h)}if(0<e)for(h=t;h<t+i;++h){for(u=0,o=e-1;0<=o&&0==this._cells[3*(h+o*a)];--o,u++);for(o=u;0<o;--o)this._cells[3*(h+(e-o)*a)+2]=o,this._check(0<o)}this._used+=i*r/(this._width*this._height)},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[r+1]=this._width-i,this._cells[r+2]=this._width-e}},t}(),F=function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Ot(t,35048),e?this._vb._resizeBuffer(e,!1):c.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new Bt,i&&this._ib._resizeBuffer(i,!1)}l(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,n=0;n<t;n++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Mt),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,r=0;r<e;r++){var n=this._attribInfo[i+1],a=this._attribInfo[i],s=this._attribInfo[i+2];t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n,a,!1,this._stride,s),i+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}(),N=function(){function i(t){this._color=null,this.setValue(t)}l(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:p.create(t):p.create("#000000")},t.reset=function(){this._color=p.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:p.create(t);return e._drawStyle||(e._drawStyle=new i(t))}return i.DEFAULT},s(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),U=function(){function S(){this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.bmpData32=null,this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.textureMem=0,this.fontStr=null,this.textAtlases=[],this.isoTextures=[],this.tmpAtlasPos=new M;var t=!1,e=y.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),u.onMiniGame&&!t&&(S.isWan1Wan=!0),u.onLimixiu&&(S.isWan1Wan=!0),this.charRender=C.isConchApp?new St:new Rt(S.atlasWidth,S.atlasWidth,S.scaleFontWithCtx,!S.isWan1Wan,!1),S.textRenderInst=this,y.textRender=this,S.atlasWidth2=S.atlasWidth*S.atlasWidth}l(S,"laya.webgl.text.TextRender");var t=S.prototype;return t.setFont=function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,r=e>>16&255,n=e>>8&255,a=255&e,s=t._size/S.standardFontSize;this.fontSizeOffX=Math.ceil(i*s),this.fontSizeOffY=Math.ceil(r*s),this.fontSizeW=Math.ceil(n*s),this.fontSizeH=Math.ceil(a*s),this.fontStr=t._font.replace("italic","")}},t.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(e<=i)return null;for(var r=i,n=0;r<e;r++){var a=t.charCodeAt(r);if(a>>>11==27){if(1==n)break;n=1,r++}else if(65038===a||65039===a);else if(8205==a)n=2;else if(0==n)n=1;else if(1==n)break}return this._curStrPos=r,t.substring(i,r)},t.filltext=function(t,e,i,r,n,a,s,o,h,l){if(void 0===l&&(l=0),!(e.length<=0)){var u=f.Parse(n),c=0;switch(h){case"center":c=w.ENUM_TEXTALIGN_CENTER;break;case"right":c=w.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,r,u,a,s,o,c,l)}},t.fillWords=function(t,e,i,r,n,a,s,o){if(e&&!(e.length<=0)){var h=f.Parse(n);this._fast_filltext(t,null,e,i,r,h,a,s,o,0,0)}},t._fast_filltext=function(t,e,i,r,n,a,s,o,h,l,u){if(void 0===u&&(u=0),!(e&&e.length<1||i&&i.length<1)){if(h<0&&(h=0),this.setFont(a),this.fontScaleX=this.fontScaleY=1,!C.isConchApp&&S.scaleFontWithCtx){var c=1,_=1;if(_=C.isConchApp?(c=t._curMat.getScaleX(),t._curMat.getScaleY()):(c=t.getMatScaleX(),t.getMatScaleY()),c<1e-4||_<.1)return;1<c&&(this.fontScaleX=c),1<_&&(this.fontScaleY=_)}a._italic&&(t._italicDeg=13);var f=e,d=!i&&e instanceof laya.utils.WordText,p=e,m=!!i,x=d?f.pageChars:[],v=0;switch(d?(p=f._text,(v=f.width)<0&&(v=f.width=this.charRender.getWidth(this.fontStr,p))):v=p?this.charRender.getWidth(this.fontStr,p):0,l){case w.ENUM_TEXTALIGN_CENTER:r-=v/2;break;case w.ENUM_TEXTALIGN_RIGHT:r-=v}f&&x&&this.hasFreedText(x)&&(x=f.pageChars=[]);var g=null,T=this.renderPerChar=!d||S.forceSplitRender||m;if(!x||x.length<1)if(T){var b,y=0,A=0;for(this._curStrPos=0;;){if(m){var E=i[this._curStrPos++];E?(b=E.char,y=E.x,A=E.y):b=null}else b=this.getNextChar(p);if(!b)break;if(!(g=this.getCharRenderInfo(b,a,s,o,h,!1)))break;if(g.isSpace);else{var R=x[g.tex.id];R||(x[g.tex.id]=R=[]),C.isConchApp?R.push({ri:g,x:y,y:A,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}):R.push({ri:g,x:y+1/this.fontScaleX,y:A/this.fontScaleY,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}),y+=g.width}}}else{var M=S.noAtlas||v*this.fontScaleX>S.atlasWidth;g=this.getCharRenderInfo(p,a,s,o,h,M),C.isConchApp?x[0]=[{ri:g,x:0,y:0,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}]:x[0]=[{ri:g,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}]}this._drawResortedWords(t,r,n,x),t._italicDeg=0}},t._drawResortedWords=function(t,e,i,r){var n=t._charSubmitCache&&t._charSubmitCache._enbale;for(var a in r){var s=r[a],o=s.length;if(!(o<=0))for(var h=0;h<o;h++){var l=s[h],u=l.ri;u.isSpace||(u.touch(),t.drawTexAlign=!0,C.isConchApp?t._drawTextureM(u.tex.texture,e+l.x-u.orix,i+l.y-u.oriy,l.w,l.h,null,1,u.uv):t._inner_drawTexture(u.tex.texture,u.tex.texture.bitmap.id,e+l.x-u.orix,i+l.y-u.oriy,l.w,l.h,null,u.uv,1,n),t.touches&&t.touches.push(u))}}},t.hasFreedText=function(t){for(var e in t)for(var i=t[e],r=0,n=i.length;r<n;r++){var a=i[r].ri;if(a.deleted||a.tex.__destroyed)return!0}return!1},t.getCharRenderInfo=function(t,e,i,r,n,a){void 0===a&&(a=!1);var s=this.mapFont[e._family];null==s&&(this.mapFont[e._family]=s=this.fontID++);var o=t+"_"+s+"_"+e._size+"_"+i;0<n&&(o+="_"+r+n),e._bold&&(o+="P"),1==this.fontScaleX&&1==this.fontScaleY||(o+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var h=0,l=this.textAtlases.length,u=null,c=null;if(!a)for(h=0;h<l;h++)if(u=(c=this.textAtlases[h]).charMaps[o])return u.touch(),u;u=new j,this.charRender.scale(this.fontScaleX,this.fontScaleY),u.char=t,u.height=e._size;var _=e._size/3|0,f=null,d=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(d>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,d+2*_)),a){f=this.charRender.getCharBmp(t,this.fontStr,n,i,r,u,_,_,_,_,null);var p=Dt.getTextTexture(f.width,f.height);p.addChar(f,0,0,u.uv),u.tex=p,u.orix=_,u.oriy=_,p.ri=u,this.isoTextures.push(p)}else{var m=t.length,x=1*n,v=Math.ceil((this.fontSizeW+2*x)*this.fontScaleX),g=Math.ceil((this.fontSizeH+2*x)*this.fontScaleY);S.imgdtRect[0]=(_-this.fontSizeOffX-x)*this.fontScaleX|0,S.imgdtRect[1]=(_-this.fontSizeOffY-x)*this.fontScaleY|0,this.renderPerChar||1==m?(S.imgdtRect[2]=Math.max(d,v),S.imgdtRect[3]=Math.max(d,g)):(S.imgdtRect[2]=-1,S.imgdtRect[3]=g),f=this.charRender.getCharBmp(t,this.fontStr,n,i,r,u,_,_,_,_,S.imgdtRect),c=this.addBmpData(f,u),u.oriy=S.isWan1Wan?u.orix=_:(u.orix=this.fontSizeOffX+x,this.fontSizeOffY+x),c.charMaps[o]=u}return u},t.addBmpData=function(t,e){for(var i=t.width,r=t.height,n=this.textAtlases.length,a=null,s=!1,o=0;o<n&&!(s=(a=this.textAtlases[o]).getAEmpty(i,r,this.tmpAtlasPos));o++);if(!s){if(a=new pt,this.textAtlases.push(a),!(s=a.getAEmpty(i,r,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return s&&(a.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=a.texture),a},t.GC=function(t){for(var e=0,i=this.textAtlases.length,r=0,n=S.destroyAtlasDt,a=0,s=-1,o=0,h=null,l=null;e<i;e++){if(h=(l=this.textAtlases[e]).texture){h.curUsedCovRate,a+=h.curUsedCovRateAtlas;var u=l.usedRate-h.curUsedCovRateAtlas;o<u&&(o=u,s=e)}n<(r=g.loopCount-l.texture.lastTouchTm)&&(S.showLog&&console.log(l.texture.id),l.destroy(),this.textAtlases[e]=this.textAtlases[i-1],i--,e--)}for(this.textAtlases.length=i,i=this.isoTextures.length,e=0;e<i;e++)h=this.isoTextures[e],r=g.loopCount-h.lastTouchTm,S.destroyUnusedTextureDt<r&&(h.ri.deleted=!0,h.ri.tex=null,h.destroy(),this.isoTextures[e]=this.isoTextures[i-1],i--,e--);var c=1<this.textAtlases.length&&2<=this.textAtlases.length-a;(S.atlasWidth*S.atlasWidth*4*this.textAtlases.length>S.cleanMem||c||S.simClean)&&(S.simClean=!1,S.showLog&&console.log("清理使用率低的贴图。总使用率:",a,":",this.textAtlases.length,"最差贴图:"+s),0<=s&&((l=this.textAtlases[s]).destroy(),this.textAtlases[s]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),Dt.clean()},t.cleanAtlases=function(){},t.getCharBmp=function(t){},t.checkBmpLine=function(t,e,i,r){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var n=t.width*e+i,a=i;a<r;a++)if(0!=this.bmpData32[n++])return!0;return!1},t.updateBbx=function(t,e,i){void 0===i&&(i=!1);var r=t.width,n=t.height,a=0,s=e[1],o=0,h=s;if(this.checkBmpLine(t,s,0,r))for(;;){if(s<=(h=(s+o)/2|0)+1){e[1]=h;break}this.checkBmpLine(t,h,0,r)?s=h:o=h}if(e[3]>n)e[3]=n;else if(h=s=e[3],o=n,this.checkBmpLine(t,s,0,r))for(;;){if((h=(s+o)/2|0)-1<=s){e[3]=h;break}this.checkBmpLine(t,h,0,r)?s=h:o=h}if(!i){var l=e[0],u=r*e[1];for(h=e[1];h<e[3];h++){for(a=0;a<l;a++)if(0!=this.bmpData32[u+a]){l=a;break}u+=r}e[0]=l;var c=e[2];for(u=r*e[1],h=e[1];h<e[3];h++){for(a=c;a<r;a++)if(0!=this.bmpData32[u+a]){c=a;break}u+=r}e[2]=c}},t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var i="bold "+S.standardFontSize+"px "+t;if(S.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"有"),this.fontSizeH=1.5*S.standardFontSize;var r=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=r}S.pixelBBX[0]=S.standardFontSize/2,S.pixelBBX[1]=S.standardFontSize/2,S.pixelBBX[2]=S.standardFontSize,S.pixelBBX[3]=S.standardFontSize;var n=16,a=16;this.charRender.scale(1,1),S.tmpRI.height=S.standardFontSize;var s=this.charRender.getCharBmp("g",i,0,"red",null,S.tmpRI,n,a,16,16);C.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),this.updateBbx(s,S.pixelBBX,!1),s=this.charRender.getCharBmp("有",i,0,"red",null,S.tmpRI,a,a,16,16),C.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),S.pixelBBX[2]<n+S.tmpRI.width&&(S.pixelBBX[2]=n+S.tmpRI.width),this.updateBbx(s,S.pixelBBX,!1),C.isConchApp&&(a=n=0);var o=Math.max(n-S.pixelBBX[0],0)<<24|Math.max(a-S.pixelBBX[1],0)<<16|S.pixelBBX[2]-S.pixelBBX[0]<<8|S.pixelBBX[3]-S.pixelBBX[1];return this.fontSizeInfo[t]=o},t.printDbgInfo=function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+S.atlasWidth+"x"+S.atlasWidth," 用canvas:",S.isWan1Wan),console.log("图集占用空间:"+S.atlasWidth*S.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,r=e>>16&255,n=e>>8&255,a=255&e;console.log("    "+t," off:",i,r," size:",n,a)}var s=0;console.log("缓存数据:");var o=0,h=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=g.loopCount-t.texture.lastTouchTm,r=0<i?i+"帧以前":"当前帧";for(var n in o+=t.texture.curUsedCovRate,h+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+r+")--:"),t.charMaps){var a=t.charMaps[n];console.log("     off:",a.orix,a.oriy," bmp宽高:",a.bmpWidth,a.bmpHeight,"无效:",a.deleted,"touchdt:",g.loopCount-a.touchTick,"位置:",a.uv[0]*S.atlasWidth|0,a.uv[1]*S.atlasWidth|0,"字符:",a.char,"key:",n),s++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",g.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",s,"总使用率:",o,"总当前图集使用率:",h)},t.showAtlas=function(t,i,e,r,n,a){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var s=new _,o=this.textAtlases[t].texture,h={width:S.atlasWidth,height:S.atlasWidth,sourceWidth:S.atlasWidth,sourceHeight:S.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return o._getSource()},bitmap:{id:o.id},_uv:A.DEF_UV};return s.size=function(t,e){return this.width=t,this.height=e,s.graphics.clear(),s.graphics.drawRect(0,0,s.width,s.height,i),s.graphics.drawTexture(h,0,0,s.width,s.height),this},s.graphics.drawRect(0,0,n,a,i),s.graphics.drawTexture(h,0,0,n,a),s.pos(e,r),y.stage.addChild(s),s},t.filltext_native=function(t,e,i,r,n,a,s,o,h,l,u){if(void 0===u&&(u=0),!(e&&e.length<=0||i&&i.length<1)){var c=f.Parse(a),_=0;switch(l){case"center":_=w.ENUM_TEXTALIGN_CENTER;break;case"right":_=w.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,r,n,c,s,o,h,_,u)}},S.useOldCharBook=!1,S.atlasWidth=2048,S.noAtlas=!1,S.forceSplitRender=!1,S.forceWholeRender=!1,S.scaleFontWithCtx=!0,S.standardFontSize=32,S.destroyAtlasDt=10,S.checkCleanTextureDt=2e3,S.destroyUnusedTextureDt=3e3,S.cleanMem=104857600,S.isWan1Wan=!1,S.showLog=!1,S.debugUV=!1,S.atlasWidth2=4194304,S.textRenderInst=null,S.simClean=!1,s(S,["tmpRI",function(){return this.tmpRI=new j},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]),S}(),V=(function(){function h(){}l(h,"laya.webgl.utils.MatirxArray"),h.ArrayMul=function(t,e,i){if(t)if(e)for(var r=NaN,n=NaN,a=NaN,s=NaN,o=0;o<4;o++)r=t[o],n=t[o+4],a=t[o+8],s=t[o+12],i[o]=r*e[0]+n*e[1]+a*e[2]+s*e[3],i[o+4]=r*e[4]+n*e[5]+a*e[6]+s*e[7],i[o+8]=r*e[8]+n*e[9]+a*e[10]+s*e[11],i[o+12]=r*e[12]+n*e[13]+a*e[14]+s*e[15];else h.copyArray(t,i);else h.copyArray(e,i)},h.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function t(){}return l(t,"laya.webgl.VertexArrayObject"),t}()(function(){var n={};function c(t,e){var i;n[t]=!0,void 0!==e&&(i=e,d.console&&d.console.error&&d.console.error(i))}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var r=0;r<this.attribs.length;r++){var n=new t.VertexAttrib(i);this.attribs[r]=n}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var r=function(r){var e,i,h=this;this.gl=r,i=(e=r).getError,e.getError=function(){for(;(t=i.apply(e))!=e.NO_ERROR&&(n[t]=!0),t!=e.NO_ERROR;);for(var t in n)if(n[t])return delete n[t],parseInt(t);return e.NO_ERROR};var l=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(t){return t==h.VERTEX_ARRAY_BINDING_OES?h.currentVertexArrayObject==h.defaultVertexArrayObject?null:h.currentVertexArrayObject:l.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(t){var e=h.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,l.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(t){var e=h.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,l.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(t,e){switch(t){case r.ARRAY_BUFFER:h.currentArrayBuffer=e;break;case r.ELEMENT_ARRAY_BUFFER:h.currentVertexArrayObject.elementArrayBuffer=e}return l.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(t,e){var i=h.currentVertexArrayObject.attribs[t];switch(e){case r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case r.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case r.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case r.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case r.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case r.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return l.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(t,e,i,r,n,a){var s=h.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,t);var o=s.attribs[t];return o.buffer=h.currentArrayBuffer,o.size=e,o.type=i,o.normalized=r,o.stride=n,o.offset=a,o.recache(),l.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener&&r.canvas.addEventListener("webglcontextrestored",function(){var t;t="OESVertexArrayObject emulation library context restored",d.console&&d.console.log&&d.console.log(t),h.reset_()},!0),this.reset_()};r.prototype.VERTEX_ARRAY_BINDING_OES=34229,r.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},r.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},r.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},r.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},r.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var n=this.currentVertexArrayObject;if(r!=n){r&&n.elementArrayBuffer==r.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer);for(var a=this.currentArrayBuffer,s=Math.max(r?r.maxAttrib:0,n.maxAttrib),o=0;o<=s;o++){var h=n.attribs[o],l=r?r.attribs[o]:null;if(r&&h.enabled==l.enabled||(h.enabled?i.enableVertexAttribArray.call(e,o):i.disableVertexAttribArray.call(e,o)),h.enabled){var u=!1;r&&h.buffer==l.buffer||(a!=h.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,h.buffer),a=h.buffer),u=!0),(u||h.cached!=l.cached)&&i.vertexAttribPointer.call(e,o,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=a&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else c(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},d._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject))}},d._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e||null}}}()),function(){function r(){}l(r,"laya.webgl.text.ArabicReshaper");var t=r.prototype;t.characterMapContains=function(t){for(var e=0;e<r.charsMap.length;++e)if(r.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<r.charsMap.length;++e)if(r.charsMap[e][0]===t)return r.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var i=0;i<r.combCharsMap.length;++i)if(r.combCharsMap[i][0][0]===t&&r.combCharsMap[i][0][1]===e)return r.combCharsMap[i];return!1},t.isTransparent=function(t){for(var e=0;e<r.transChars.length;++e)if(r.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<r.charsMap.length;++e)if(-1<r.charsMap[e].indexOf(t))return String.fromCharCode(r.charsMap[e][0]);for(e=0;e<r.combCharsMap.length;++e)if(-1<r.combCharsMap[e].indexOf(t))return String.fromCharCode(r.combCharsMap[e][0][0])+String.fromCharCode(r.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,i,r="",n=0;n<t.length;++n){var a=t.charCodeAt(n);if(this.characterMapContains(a)){for(var s=null,o=null,h=n-1,l=n+1;0<=h&&this.isTransparent(t.charCodeAt(h));--h);for((!(e=!!(s=0<=h?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[2]&&null==e[3])&&(s=null);l<t.length&&this.isTransparent(t.charCodeAt(l));++l);if((!(e=!!(o=l<t.length?t.charCodeAt(l):null)&&this.getCharRep(o))||null==e[3]&&null==e[4])&&(o=null),1604===a&&null!=o&&(1570===o||1571===o||1573===o||1575===o)){i=this.getCombCharRep(a,o),r+=null!=s?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++n;continue}if(e=this.getCharRep(a),null!=s&&null!=o&&null!=e[3]){r+=String.fromCharCode(e[3]);continue}if(null!=s&&null!=e[4]){r+=String.fromCharCode(e[4]);continue}if(null!=o&&null!=e[2]){r+=String.fromCharCode(e[2]);continue}r+=String.fromCharCode(e[1])}else r+=String.fromCharCode(a)}return r},t.convertArabicBack=function(t){var e="",i=0,r=0;for(r=0;r<t.length;++r)i=t.charCodeAt(r),e+=this.getOriginalCharsFromCode(i);return e},s(r,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function r(){this._saveuse=0}l(r,"laya.webgl.canvas.save.SaveMark");var t=r.prototype;return y.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,r.POOL[r.POOL._length++]=this},r.Create=function(t){var e=r.POOL,i=0<e._length?e[--e._length]:new r;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},r.POOL=I._createArray(),r}()),k=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}l(e,"laya.webgl.shader.ShaderDefinesBase");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,r){r[i[t]=e]=t},e._toText=function(t,e,i){var r=i[t];if(r)return r;for(var n={},a=1,s=0;s<32&&!(t<(a=1<<s));s++)if(t&a){var o=e[a];o&&(n[o]="")}return i[t]=n},e._toInt=function(t,e){for(var i=t.split("."),r=0,n=0,a=i.length;n<a;n++){var s=e[i[n]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[n]);r|=s}return r},e}(),W=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}l(i,"laya.webgl.utils.ShaderNode");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(r,n,a){if(this.childs.length<1&&!this.text)return n;n.length;if(this.condition){var t=!!this.condition.call(r);if(2===this.conditionType&&(t=!t),!t)return n}if(this.text&&n.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(r,n,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,s=this.includefiles.length;i<s;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,n[0]=e+n[0]);return n},i.__id=1,i}(),X=(function(){function t(){}l(t,"laya.webgl.shader.ShaderValue")}(),function(){function t(){}l(t,"laya.webgl.resource.ICharRender");var e=t.prototype;return e.getWidth=function(t,e){return 0},e.scale=function(t,e){},e.getCharBmp=function(t,e,i,r,n,a,s,o,h,l,u){return null},o(0,e,"canvasWidth",function(){return 0},function(t){}),t}()),G=function(){function t(){}return l(t,"laya.layagl.LayaGLRunner"),t.uploadShaderUniforms=function(t,e,i,r){for(var n=i._data,a=e.getArrayData(),s=0,o=0,h=a.length;o<h;o++){var l=a[o];if(r||-1!==l.textureID){var u=n[l.dataOffset];null!=u&&(s+=l.fun.call(l.caller,l,u))}}return s},t.uploadCustomUniform=function(t,e,i,r){var n=0,a=e[i];return a&&null!=r&&(n+=a.fun.call(a.caller,a,r)),n},t.uploadShaderUniformsForNative=function(t,e,i){var r=0;0<i._runtimeCopyValues.length&&(r=1);var n=i._data;return t.uploadShaderUniforms(e,n,r)},t}(),H=function(){function t(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=O.instance.createVertexArray()}l(t,"laya.webgl.BufferStateBase");var e=t.prototype;return e.bind=function(){t._curBindedBufferState!==this&&(O.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this)},e.unBind=function(){if(t._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";O.instance.bindVertexArray(null),t._curBindedBufferState=null},e.bindForNative=function(){O.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this},e.unBindForNative=function(){O.instance.bindVertexArray(null),t._curBindedBufferState=null},e.destroy=function(){O.instance.deleteVertexArray(this._nativeVertexArrayObject)},t._curBindedBufferState=null,t}(),z=function(){function v(t,e,i,r){this._clearCR=new RegExp("\r","g");var n=this;function a(t){t=t.replace(n._clearCR,"");var e=[],i=new W(e);return n._compileToTree(i,t.split("\n"),0,e,r),i}var s=u.now();this._VS=a(t),this._PS=a(e),this._nameMap=i,2<u.now()-s&&console.log("ShaderCompile use time:"+(u.now()-s)+"  size:"+t.length+"/"+e.length)}l(v,"laya.webgl.utils.ShaderCompile");var t=v.prototype;return t._compileToTree=function(t,e,i,r,n){var a,s,o,h,l,u,c,_=0,f=0,d=0,p=0;for(f=i;f<e.length;f++)if(!((o=e[f]).length<1)&&0!==(_=o.indexOf("//"))){if(0<=_&&(o=o.substr(0,_)),a=c||new W(r),c=null,a.text=o,a.noCompile=!0,0<=(_=o.indexOf("#"))){for(h="#",p=_+1,d=o.length;p<d;p++){var m=o.charAt(p);if(" "===m||"\t"===m||"?"===m)break;h+=m}switch(a.name=h){case"#ifdef":case"#ifndef":if(a.src=o,a.noCompile=null!=o.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+o.substr(_+a.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),a.setCondition(u[1],"#ifdef"===h?1:2),a.text="//"+a.text),a.setParent(t),t=a,n)for(u=o.substr(p).split(v._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&(n[o]=!0);continue;case"#if":if(a.src=o,a.noCompile=!0,a.setParent(t),t=a,n)for(u=o.substr(p).split(v._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&"defined"!=o&&(n[o]=!0);continue;case"#else":a.src=o,s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.condition=s.condition,a.conditionType=1==s.conditionType?2:1,a.text="//"+a.text+" "+s.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":u=v.splitToWords(o,null);var x=v.includes[u[1]];if(!x)throw"ShaderCompile error no this include file:"+u[1];if((_=u[0].indexOf("?"))<0){a.setParent(t),o=x.getWith("with"==u[2]?u[3]:null),this._compileToTree(a,o.split("\n"),0,r,n),a.text="";continue}a.setCondition(u[0].substr(_+1),1),a.text=x.getWith("with"==u[2]?u[3]:null);break;case"#import":l=(u=v.splitToWords(o,null))[1],r.push({node:a,file:v.includes[l],ofs:a.text.length});continue}}else{if((s=t.childs[t.childs.length-1])&&!s.name){0<r.length&&v.splitToWords(o,s),c=a,s.text+="\n"+o;continue}0<r.length&&v.splitToWords(o,a)}a.setParent(t)}},t.createShader=function(t,e,i,r){var n={},a="";if(t)for(var s in t)a+="#define "+s+"\n",n[s]=!0;var o=this._VS.toscript(n,[]),h=this._PS.toscript(n,[]);return(i||Ft.create)(a+o.join("\n"),a+h.join("\n"),e,this._nameMap,r)},v._parseOne=function(t,e,i,r,n,a){var s={type:v.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return a&&("attribute"==n?t.push(s):e.push(s)),":"==i[r+3]&&(s.type=i[r+4],r+=2),r+=2},v.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(v.includes[t])throw new Error("add shader include file err, has add:"+t);v.includes[t]=new st(e)},v.preGetParams=function(t,e){var i=[t,e],r={},n=[],a=[],s={},o=[];r.attributes=n,r.uniforms=a,r.defines=s;for(var h=0,l=0,u=0;u<2;u++){i[u]=i[u].replace(v._removeAnnotation,"");var c,_=i[u].match(v._reg);for(h=0,l=_.length;h<l;h++){var f=_[h];if("attribute"==f||"uniform"==f)h=v._parseOne(n,a,_,h,f,!0);else{if("#define"==f){o[f=_[++h]]=1;continue}if("#ifdef"==f){s[c=_[++h]]=s[c]||[];for(h++;h<l;h++)if("attribute"==(f=_[h])||"uniform"==f)h=v._parseOne(n,a,_,h,f,o[c]);else if("#else"==f)for(h++;h<l;h++)if("attribute"==(f=_[h])||"uniform"==f)h=v._parseOne(n,a,_,h,f,!o[c]);else if("#endif"==f)break}}}}return r},v.splitToWords=function(t,e){for(var i,r,n=[],a=-1,s=0,o=t.length;s<o;s++)if(i=t.charAt(s),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<s-a&&(r=t.substr(a,s-a),n.push(r)),'"'==i||"'"==i){var h=t.indexOf(i,s+1);if(h<0)throw"Sharder err:"+t;n.push(t.substr(s+1,h-s-1)),s=h,a=-1;continue}"("==i&&e&&0<n.length&&(r=n[n.length-1]+";","vec4;main;".indexOf(r)<0&&(e.useFuns+=r)),a=-1}else a<0&&(a=s);return a<o&&1<o-a&&(r=t.substr(a,o-a),n.push(r)),n},v.IFDEF_NO=0,v.IFDEF_YES=1,v.IFDEF_ELSE=2,v.IFDEF_PARENT=3,v._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),v._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),v._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),v.includes={},s(v,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),v}(),Y=function(){function a(){}l(a,"laya.webgl.WebGLContext");var t=a.prototype;return t.getContextAttributes=function(){return null},t.isContextLost=function(){},t.getSupportedExtensions=function(){return null},t.getExtension=function(t){return null},t.activeTexture=function(t){},t.attachShader=function(t,e){},t.bindAttribLocation=function(t,e,i){},t.bindBuffer=function(t,e){},t.bindFramebuffer=function(t,e){},t.bindRenderbuffer=function(t,e){},t.bindTexture=function(t,e){},t.useTexture=function(t){},t.blendColor=function(t,e,i,r){},t.blendEquation=function(t){},t.blendEquationSeparate=function(t,e){},t.blendFunc=function(t,e){},t.blendFuncSeparate=function(t,e,i,r){},t.bufferData=function(t,e,i){},t.bufferSubData=function(t,e,i){},t.checkFramebufferStatus=function(t){return null},t.clear=function(t){},t.clearColor=function(t,e,i,r){},t.clearDepth=function(t){},t.clearStencil=function(t){},t.colorMask=function(t,e,i,r){},t.compileShader=function(t){},t.copyTexImage2D=function(t,e,i,r,n,a,s,o){},t.copyTexSubImage2D=function(t,e,i,r,n,a,s,o){},t.createBuffer=function(){},t.createFramebuffer=function(){},t.createProgram=function(){},t.createRenderbuffer=function(){},t.createShader=function(t){},t.createTexture=function(){return null},t.cullFace=function(t){},t.deleteBuffer=function(t){},t.deleteFramebuffer=function(t){},t.deleteProgram=function(t){},t.deleteRenderbuffer=function(t){},t.deleteShader=function(t){},t.deleteTexture=function(t){},t.depthFunc=function(t){},t.depthMask=function(t){},t.depthRange=function(t,e){},t.detachShader=function(t,e){},t.disable=function(t){},t.disableVertexAttribArray=function(t){},t.drawArrays=function(t,e,i){},t.drawElements=function(t,e,i,r){},t.enable=function(t){},t.enableVertexAttribArray=function(t){},t.finish=function(){},t.flush=function(){},t.framebufferRenderbuffer=function(t,e,i,r){},t.framebufferTexture2D=function(t,e,i,r,n){},t.frontFace=function(t){return null},t.generateMipmap=function(t){return null},t.getActiveAttrib=function(t,e){return null},t.getActiveUniform=function(t,e){return null},t.getAttribLocation=function(t,e){return 0},t.getParameter=function(t){return null},t.getBufferParameter=function(t,e){return null},t.getError=function(){return null},t.getFramebufferAttachmentParameter=function(t,e,i){},t.getProgramParameter=function(t,e){return 0},t.getProgramInfoLog=function(t){return null},t.getRenderbufferParameter=function(t,e){return null},t.getShaderPrecisionFormat=function(t){return null},t.getShaderParameter=function(t,e){},t.getShaderInfoLog=function(t){return null},t.getShaderSource=function(t){return null},t.getTexParameter=function(t,e){},t.getUniform=function(t,e){},t.getUniformLocation=function(t,e){return null},t.getVertexAttrib=function(t,e){return null},t.getVertexAttribOffset=function(t,e){return null},t.hint=function(t,e){},t.isBuffer=function(t){},t.isEnabled=function(t){},t.isFramebuffer=function(t){},t.isProgram=function(t){},t.isRenderbuffer=function(t){},t.isShader=function(t){},t.isTexture=function(t){},t.lineWidth=function(t){},t.linkProgram=function(t){},t.pixelStorei=function(t,e){},t.polygonOffset=function(t,e){},t.readPixels=function(t,e,i,r,n,a,s){},t.renderbufferStorage=function(t,e,i,r){},t.sampleCoverage=function(t,e){},t.scissor=function(t,e,i,r){},t.shaderSource=function(t,e){},t.stencilFunc=function(t,e,i){},t.stencilFuncSeparate=function(t,e,i,r){},t.stencilMask=function(t){},t.stencilMaskSeparate=function(t,e){},t.stencilOp=function(t,e,i){},t.stencilOpSeparate=function(t,e,i,r){},t.texImage2D=function(t){},t.texParameterf=function(t,e,i){},t.texParameteri=function(t,e,i){},t.texSubImage2D=function(t){},t.uniform1f=function(t,e){},t.uniform1fv=function(t,e){},t.uniform1i=function(t,e){},t.uniform1iv=function(t,e){},t.uniform2f=function(t,e,i){},t.uniform2fv=function(t,e){},t.uniform2i=function(t,e,i){},t.uniform2iv=function(t,e){},t.uniform3f=function(t,e,i,r){},t.uniform3fv=function(t,e){},t.uniform3i=function(t,e,i,r){},t.uniform3iv=function(t,e){},t.uniform4f=function(t,e,i,r,n){},t.uniform4fv=function(t,e){},t.uniform4i=function(t,e,i,r,n){},t.uniform4iv=function(t,e){},t.uniformMatrix2fv=function(t,e,i){},t.uniformMatrix3fv=function(t,e,i){},t.uniformMatrix4fv=function(t,e,i){},t.useProgram=function(t){},t.validateProgram=function(t){},t.vertexAttrib1f=function(t,e){},t.vertexAttrib1fv=function(t,e){},t.vertexAttrib2f=function(t,e,i){},t.vertexAttrib2fv=function(t,e){},t.vertexAttrib3f=function(t,e,i,r){},t.vertexAttrib3fv=function(t,e){},t.vertexAttrib4f=function(t,e,i,r,n){},t.vertexAttrib4fv=function(t,e){},t.vertexAttribPointer=function(t,e,i,r,n,a){},t.viewport=function(t,e,i,r){},t.configureBackBuffer=function(t,e,i,r,n){void 0===r&&(r=!0),void 0===n&&(n=!1)},t.compressedTexImage2D=function(t){},t.createVertexArray=function(){throw"not implemented"},t.bindVertexArray=function(t){throw"not implemented"},t.deleteVertexArray=function(t){throw"not implemented"},t.isVertexArray=function(t){throw"not implemented"},a.__init__=function(t){if(laya.webgl.WebGLContext._checkExtensions(t),!J._isWebGL2&&!C.isConchApp){d._setupVertexArrayObject&&(u.onBDMiniGame||u.onLimixiu?d._forceSetupVertexArrayObject(t):d._setupVertexArrayObject(t));var e=(t.rawgl||t).getExtension("OES_vertex_array_object");if(e){console.log("EXT:webgl support OES_vertex_array_object！");var i=t;i.createVertexArray=function(){return e.createVertexArrayOES()},i.bindVertexArray=function(t){e.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},i.isVertexArray=function(t){e.isVertexArrayOES(t)}}}},a._getExtension=function(t,e){var i=a._extentionVendorPrefixes;for(var r in i){var n=t.getExtension(i[r]+e);if(n)return n}return null},a._checkExtensions=function(t){return a._extTextureFilterAnisotropic=a._getExtension(t,"EXT_texture_filter_anisotropic"),a._compressedTextureS3tc=a._getExtension(t,"WEBGL_compressed_texture_s3tc"),a._compressedTexturePvrtc=a._getExtension(t,"WEBGL_compressed_texture_pvrtc"),a._compressedTextureEtc1=a._getExtension(t,"WEBGL_compressed_texture_etc1"),null},a.__init_native=function(){if(C.supportWebGLPlusRendering){var t=a;t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative}},a.useProgram=function(t,e){return a._useProgram!==e&&(t.useProgram(e),a._useProgram=e,!0)},a.setDepthTest=function(t,e){e!==a._depthTest&&((a._depthTest=e)?t.enable(2929):t.disable(2929))},a.setDepthMask=function(t,e){e!==a._depthMask&&(a._depthMask=e,t.depthMask(e))},a.setDepthFunc=function(t,e){e!==a._depthFunc&&(a._depthFunc=e,t.depthFunc(e))},a.setBlend=function(t,e){e!==a._blend&&((a._blend=e)?t.enable(3042):t.disable(3042))},a.setBlendFunc=function(t,e,i){(e!==a._sFactor||i!==a._dFactor)&&(a._sFactor=e,a._dFactor=i,t.blendFunc(e,i))},a.setCullFace=function(t,e){e!==a._cullFace&&((a._cullFace=e)?t.enable(2884):t.disable(2884))},a.setFrontFace=function(t,e){e!==a._frontFace&&(a._frontFace=e,t.frontFace(e))},a.activeTexture=function(t,e){a._activedTextureID!==e&&(t.activeTexture(e),a._activedTextureID=e)},a.bindTexture=function(t,e,i){a._activeTextures[a._activedTextureID-33984]!==i&&(t.bindTexture(e,i),a._activeTextures[a._activedTextureID-33984]=i)},a.useProgramForNative=function(t,e){return t.useProgram(e),!0},a.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},a.setDepthMaskForNative=function(t,e){t.depthMask(e)},a.setDepthFuncForNative=function(t,e){t.depthFunc(e)},a.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},a.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},a.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},a.setFrontFaceForNative=function(t,e){t.frontFace(e)},a.activeTextureForNative=function(t,e){t.activeTexture(e)},a.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},a.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},a.DEPTH_BUFFER_BIT=256,a.STENCIL_BUFFER_BIT=1024,a.COLOR_BUFFER_BIT=16384,a.POINTS=0,a.LINES=1,a.LINE_LOOP=2,a.LINE_STRIP=3,a.TRIANGLES=4,a.TRIANGLE_STRIP=5,a.TRIANGLE_FAN=6,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.FUNC_ADD=32774,a.BLEND_EQUATION=32777,a.BLEND_EQUATION_RGB=32777,a.BLEND_EQUATION_ALPHA=34877,a.FUNC_SUBTRACT=32778,a.FUNC_REVERSE_SUBTRACT=32779,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.ARRAY_BUFFER=34962,a.ELEMENT_ARRAY_BUFFER=34963,a.ARRAY_BUFFER_BINDING=34964,a.ELEMENT_ARRAY_BUFFER_BINDING=34965,a.STREAM_DRAW=35040,a.STATIC_DRAW=35044,a.DYNAMIC_DRAW=35048,a.BUFFER_SIZE=34660,a.BUFFER_USAGE=34661,a.CURRENT_VERTEX_ATTRIB=34342,a.FRONT=1028,a.BACK=1029,a.CULL_FACE=2884,a.FRONT_AND_BACK=1032,a.BLEND=3042,a.DITHER=3024,a.STENCIL_TEST=2960,a.DEPTH_TEST=2929,a.SCISSOR_TEST=3089,a.POLYGON_OFFSET_FILL=32823,a.SAMPLE_ALPHA_TO_COVERAGE=32926,a.SAMPLE_COVERAGE=32928,a.NO_ERROR=0,a.INVALID_ENUM=1280,a.INVALID_VALUE=1281,a.INVALID_OPERATION=1282,a.OUT_OF_MEMORY=1285,a.CW=2304,a.CCW=2305,a.LINE_WIDTH=2849,a.ALIASED_POINT_SIZE_RANGE=33901,a.ALIASED_LINE_WIDTH_RANGE=33902,a.CULL_FACE_MODE=2885,a.FRONT_FACE=2886,a.DEPTH_RANGE=2928,a.DEPTH_WRITEMASK=2930,a.DEPTH_CLEAR_VALUE=2931,a.DEPTH_FUNC=2932,a.STENCIL_CLEAR_VALUE=2961,a.STENCIL_FUNC=2962,a.STENCIL_FAIL=2964,a.STENCIL_PASS_DEPTH_FAIL=2965,a.STENCIL_PASS_DEPTH_PASS=2966,a.STENCIL_REF=2967,a.STENCIL_VALUE_MASK=2963,a.STENCIL_WRITEMASK=2968,a.STENCIL_BACK_FUNC=34816,a.STENCIL_BACK_FAIL=34817,a.STENCIL_BACK_PASS_DEPTH_FAIL=34818,a.STENCIL_BACK_PASS_DEPTH_PASS=34819,a.STENCIL_BACK_REF=36003,a.STENCIL_BACK_VALUE_MASK=36004,a.STENCIL_BACK_WRITEMASK=36005,a.VIEWPORT=2978,a.SCISSOR_BOX=3088,a.COLOR_CLEAR_VALUE=3106,a.COLOR_WRITEMASK=3107,a.UNPACK_ALIGNMENT=3317,a.PACK_ALIGNMENT=3333,a.MAX_TEXTURE_SIZE=3379,a.MAX_VIEWPORT_DIMS=3386,a.SUBPIXEL_BITS=3408,a.RED_BITS=3410,a.GREEN_BITS=3411,a.BLUE_BITS=3412,a.ALPHA_BITS=3413,a.DEPTH_BITS=3414,a.STENCIL_BITS=3415,a.POLYGON_OFFSET_UNITS=10752,a.POLYGON_OFFSET_FACTOR=32824,a.TEXTURE_BINDING_2D=32873,a.SAMPLE_BUFFERS=32936,a.SAMPLES=32937,a.SAMPLE_COVERAGE_VALUE=32938,a.SAMPLE_COVERAGE_INVERT=32939,a.NUM_COMPRESSED_TEXTURE_FORMATS=34466,a.COMPRESSED_TEXTURE_FORMATS=34467,a.DONT_CARE=4352,a.FASTEST=4353,a.NICEST=4354,a.GENERATE_MIPMAP_HINT=33170,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.DEPTH_COMPONENT=6402,a.ALPHA=6406,a.RGB=6407,a.RGBA=6408,a.LUMINANCE=6409,a.LUMINANCE_ALPHA=6410,a.UNSIGNED_SHORT_4_4_4_4=32819,a.UNSIGNED_SHORT_5_5_5_1=32820,a.UNSIGNED_SHORT_5_6_5=33635,a.FRAGMENT_SHADER=35632,a.VERTEX_SHADER=35633,a.MAX_VERTEX_ATTRIBS=34921,a.MAX_VERTEX_UNIFORM_VECTORS=36347,a.MAX_VARYING_VECTORS=36348,a.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,a.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,a.MAX_TEXTURE_IMAGE_UNITS=34930,a.MAX_FRAGMENT_UNIFORM_VECTORS=36349,a.SHADER_TYPE=35663,a.DELETE_STATUS=35712,a.LINK_STATUS=35714,a.VALIDATE_STATUS=35715,a.ATTACHED_SHADERS=35717,a.ACTIVE_UNIFORMS=35718,a.ACTIVE_ATTRIBUTES=35721,a.SHADING_LANGUAGE_VERSION=35724,a.CURRENT_PROGRAM=35725,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.VENDOR=7936,a.RENDERER=7937,a.VERSION=7938,a.NEAREST=9728,a.LINEAR=9729,a.NEAREST_MIPMAP_NEAREST=9984,a.LINEAR_MIPMAP_NEAREST=9985,a.NEAREST_MIPMAP_LINEAR=9986,a.LINEAR_MIPMAP_LINEAR=9987,a.TEXTURE_MAG_FILTER=10240,a.TEXTURE_MIN_FILTER=10241,a.TEXTURE_WRAP_S=10242,a.TEXTURE_WRAP_T=10243,a.TEXTURE_2D=3553,a.TEXTURE_3D=32879,a.TEXTURE=5890,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_BINDING_CUBE_MAP=34068,a.TEXTURE_CUBE_MAP_POSITIVE_X=34069,a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,a.MAX_CUBE_MAP_TEXTURE_SIZE=34076,a.TEXTURE0=33984,a.TEXTURE1=33985,a.TEXTURE2=33986,a.TEXTURE3=33987,a.TEXTURE4=33988,a.TEXTURE5=33989,a.TEXTURE6=33990,a.TEXTURE7=33991,a.TEXTURE8=33992,a.TEXTURE9=33993,a.TEXTURE10=33994,a.TEXTURE11=33995,a.TEXTURE12=33996,a.TEXTURE13=33997,a.TEXTURE14=33998,a.TEXTURE15=33999,a.TEXTURE16=34e3,a.TEXTURE17=34001,a.TEXTURE18=34002,a.TEXTURE19=34003,a.TEXTURE20=34004,a.TEXTURE21=34005,a.TEXTURE22=34006,a.TEXTURE23=34007,a.TEXTURE24=34008,a.TEXTURE25=34009,a.TEXTURE26=34010,a.TEXTURE27=34011,a.TEXTURE28=34012,a.TEXTURE29=34013,a.TEXTURE30=34014,a.TEXTURE31=34015,a.ACTIVE_TEXTURE=34016,a.REPEAT=10497,a.CLAMP_TO_EDGE=33071,a.MIRRORED_REPEAT=33648,a.FLOAT_VEC2=35664,a.FLOAT_VEC3=35665,a.FLOAT_VEC4=35666,a.INT_VEC2=35667,a.INT_VEC3=35668,a.INT_VEC4=35669,a.BOOL=35670,a.BOOL_VEC2=35671,a.BOOL_VEC3=35672,a.BOOL_VEC4=35673,a.FLOAT_MAT2=35674,a.FLOAT_MAT3=35675,a.FLOAT_MAT4=35676,a.SAMPLER_2D=35678,a.SAMPLER_CUBE=35680,a.VERTEX_ATTRIB_ARRAY_ENABLED=34338,a.VERTEX_ATTRIB_ARRAY_SIZE=34339,a.VERTEX_ATTRIB_ARRAY_STRIDE=34340,a.VERTEX_ATTRIB_ARRAY_TYPE=34341,a.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,a.VERTEX_ATTRIB_ARRAY_POINTER=34373,a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,a.COMPILE_STATUS=35713,a.LOW_FLOAT=36336,a.MEDIUM_FLOAT=36337,a.HIGH_FLOAT=36338,a.LOW_INT=36339,a.MEDIUM_INT=36340,a.HIGH_INT=36341,a.FRAMEBUFFER=36160,a.RENDERBUFFER=36161,a.RGBA4=32854,a.RGB5_A1=32855,a.RGB565=36194,a.DEPTH_COMPONENT16=33189,a.STENCIL_INDEX=6401,a.STENCIL_INDEX8=36168,a.DEPTH_STENCIL=34041,a.RENDERBUFFER_WIDTH=36162,a.RENDERBUFFER_HEIGHT=36163,a.RENDERBUFFER_INTERNAL_FORMAT=36164,a.RENDERBUFFER_RED_SIZE=36176,a.RENDERBUFFER_GREEN_SIZE=36177,a.RENDERBUFFER_BLUE_SIZE=36178,a.RENDERBUFFER_ALPHA_SIZE=36179,a.RENDERBUFFER_DEPTH_SIZE=36180,a.RENDERBUFFER_STENCIL_SIZE=36181,a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,a.COLOR_ATTACHMENT0=36064,a.DEPTH_ATTACHMENT=36096,a.STENCIL_ATTACHMENT=36128,a.DEPTH_STENCIL_ATTACHMENT=33306,a.NONE=0,a.FRAMEBUFFER_COMPLETE=36053,a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,a.FRAMEBUFFER_UNSUPPORTED=36061,a.FRAMEBUFFER_BINDING=36006,a.RENDERBUFFER_BINDING=36007,a.MAX_RENDERBUFFER_SIZE=34024,a.INVALID_FRAMEBUFFER_OPERATION=1286,a.UNPACK_FLIP_Y_WEBGL=37440,a.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,a.CONTEXT_LOST_WEBGL=37442,a.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,a.BROWSER_DEFAULT_WEBGL=37444,a._extTextureFilterAnisotropic=null,a._compressedTextureS3tc=null,a._compressedTexturePvrtc=null,a._compressedTextureEtc1=null,a._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],a._useProgram=null,a._depthTest=!0,a._depthMask=!0,a._blend=!1,a._cullFace=!1,a._activedTextureID=33984,s(a,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),a}(),j=function(){function t(){this.char="",this.tex=null,this.deleted=!1,this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1,this.uv=new Array(8)}return l(t,"laya.webgl.resource.CharRenderInfo"),t.prototype.touch=function(){var t=g.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t},t}(),K=function(){function n(){this._mat=new R}l(n,"laya.webgl.canvas.save.SaveTranslate");var t=n.prototype;return y.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),n.POOL[n.POOL._length++]=this},n.save=function(t){var e=n.POOL,i=0<e._length?e[--e._length]:new n;t._curMat.copyTo(i._mat);var r=t._save;r[r._length++]=i},n.POOL=I._createArray(),n}(),Z=function(){function s(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new _t}l(s,"laya.webgl.submit.SubmitTarget");var t=s.prototype;return y.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=J.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),g.renderBatch++,g.trianglesFaces+=this._numEle/3,J.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(tt.activeBlendFunction!==tt.fns[this.blendType]){var t=J.mainContext;t.enable(3042),tt.fns[this.blendType](t),tt.activeBlendFunction=tt.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=s.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},s.create=function(t,e,i,r){var n=s.POOL._length?s.POOL[--s.POOL._length]:new s;if(n._mesh=e,n.srcRT=r,n._startIdx=e.indexNum*$.BYTES_PIDX,n._ref=1,n._key.clear(),n._numEle=0,n.blendType=t._nBlendType,n._key.blendShader=n.blendType,n.shaderValue=i,n.shaderValue.setValue(t._shader2D),t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return n},s.POOL=((s.POOL=[])._length=0,s.POOL),s}(),Q=function(){function p(){}return l(p,"laya.webgl.shapes.Earcut"),p.earcut=function(t,e,i){i=i||2;var r,n,a,s,o,h,l,u=e&&e.length,c=u?e[0]*i:t.length,_=p.linkedList(t,0,c,i,!0),f=[];if(!_)return f;if(u&&(_=p.eliminateHoles(t,e,_,i)),t.length>80*i){r=a=t[0],n=s=t[1];for(var d=i;d<c;d+=i)(o=t[d])<r&&(r=o),(h=t[d+1])<n&&(n=h),a<o&&(a=o),s<h&&(s=h);l=0!==(l=Math.max(a-r,s-n))?1/l:0}return p.earcutLinked(_,f,i,r,n,l),f},p.linkedList=function(t,e,i,r,n){var a,s;if(n===0<p.signedArea(t,e,i,r))for(a=e;a<i;a+=r)s=p.insertNode(a,t[a],t[a+1],s);else for(a=i-r;e<=a;a-=r)s=p.insertNode(a,t[a],t[a+1],s);return s&&p.equals(s,s.next)&&(p.removeNode(s),s=s.next),s},p.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!p.equals(r,r.next)&&0!==p.area(r.prev,r,r.next))r=r.next;else{if(p.removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e},p.earcutLinked=function(t,e,i,r,n,a,s){if(t){!s&&a&&p.indexCurve(t,r,n,a);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,a?p.isEarHashed(t,r,n,a):p.isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),p.removeNode(t),t=h.next,l=h.next;else if((t=h)===l){s?1===s?(t=p.cureLocalIntersections(t,e,i),p.earcutLinked(t,e,i,r,n,a,2)):2===s&&p.splitEarcut(t,e,i,r,n,a):p.earcutLinked(p.filterPoints(t,null),e,i,r,n,a,1);break}}},p.isEar=function(t){var e=t.prev,i=t,r=t.next;if(0<=p.area(e,i,r))return!1;for(var n=t.next.next;n!==t.prev;){if(p.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=p.area(n.prev,n,n.next))return!1;n=n.next}return!0},p.isEarHashed=function(t,e,i,r){var n=t.prev,a=t,s=t.next;if(0<=p.area(n,a,s))return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,h=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,u=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,c=p.zOrder(o,h,e,i,r),_=p.zOrder(l,u,e,i,r),f=t.nextZ;f&&f.z<=_;){if(f!==t.prev&&f!==t.next&&p.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=p.area(f.prev,f,f.next))return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&p.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=p.area(f.prev,f,f.next))return!1;f=f.prevZ}return!0},p.cureLocalIntersections=function(t,e,i){var r=t;do{var n=r.prev,a=r.next.next;!p.equals(n,a)&&p.intersects(n,r,r.next,a)&&p.locallyInside(n,a)&&p.locallyInside(a,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(a.i/i),p.removeNode(r),p.removeNode(r.next),r=t=a),r=r.next}while(r!==t);return r},p.splitEarcut=function(t,e,i,r,n,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&p.isValidDiagonal(s,o)){var h=p.splitPolygon(s,o);return s=p.filterPoints(s,s.next),h=p.filterPoints(h,h.next),p.earcutLinked(s,e,i,r,n,a),void p.earcutLinked(h,e,i,r,n,a)}o=o.next}s=s.next}while(s!==t)},p.eliminateHoles=function(t,e,i,r){var n,a,s,o,h,l=[];for(n=0,a=e.length;n<a;n++)s=e[n]*r,o=n<a-1?e[n+1]*r:t.length,(h=p.linkedList(t,s,o,r,!1))===h.next&&(h.steiner=!0),l.push(p.getLeftmost(h));for(l.sort(p.compareX),n=0;n<l.length;n++)p.eliminateHole(l[n],i),i=p.filterPoints(i,i.next);return i},p.compareX=function(t,e){return t.x-e.x},p.eliminateHole=function(t,e){if(e=p.findHoleBridge(t,e)){var i=p.splitPolygon(e,t);p.filterPoints(i,i.next)}},p.findHoleBridge=function(t,e){var i,r=e,n=t.x,a=t.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&s<o){if((s=o)===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i.prev;var h,l=i,u=i.x,c=i.y,_=1/0;for(r=i.next;r!==l;)n>=r.x&&r.x>=u&&n!==r.x&&p.pointInTriangle(a<c?n:s,a,u,c,a<c?s:n,a,r.x,r.y)&&((h=Math.abs(a-r.y)/(n-r.x))<_||h===_&&r.x>i.x)&&p.locallyInside(r,t)&&(i=r,_=h),r=r.next;return i},p.indexCurve=function(t,e,i,r){for(var n=t;null===n.z&&(n.z=p.zOrder(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==t;);n.prevZ.nextZ=null,n.prevZ=null,p.sortLinked(n)},p.sortLinked=function(t){var e,i,r,n,a,s,o,h,l=1;do{for(i=t,a=t=null,s=0;i;){for(s++,r=i,e=o=0;e<l&&(o++,r=r.nextZ);e++);for(h=l;0<o||0<h&&r;)0!==o&&(0===h||!r||i.z<=r.z)?(i=(n=i).nextZ,o--):(r=(n=r).nextZ,h--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;i=r}a.nextZ=null,l*=2}while(1<s);return t},p.zOrder=function(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1},p.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},p.pointInTriangle=function(t,e,i,r,n,a,s,o){return 0<=(n-s)*(e-o)-(t-s)*(a-o)&&0<=(t-s)*(r-o)-(i-s)*(e-o)&&0<=(i-s)*(a-o)-(n-s)*(r-o)},p.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!p.intersectsPolygon(t,e)&&p.locallyInside(t,e)&&p.locallyInside(e,t)&&p.middleInside(t,e)},p.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},p.equals=function(t,e){return t.x===e.x&&t.y===e.y},p.intersects=function(t,e,i,r){return!!(p.equals(t,e)&&p.equals(i,r)||p.equals(t,r)&&p.equals(i,e))||0<p.area(t,e,i)!=0<p.area(t,e,r)&&0<p.area(i,r,t)!=0<p.area(i,r,e)},p.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&p.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},p.locallyInside=function(t,e){return p.area(t.prev,t,t.next)<0?0<=p.area(t,e,t.next)&&0<=p.area(t,t.prev,e):p.area(t,e,t.prev)<0||p.area(t,t.next,e)<0},p.middleInside=function(t,e){for(var i=t,r=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r},p.splitPolygon=function(t,e){var i=new ot(t.i,t.x,t.y),r=new ot(e.i,e.x,e.y),n=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=n).prev=i,(r.next=i).prev=r,(a.next=r).prev=a,r},p.insertNode=function(t,e,i,r){var n=new ot(t,e,i);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n},p.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},p.signedArea=function(t,e,i,r){for(var n=0,a=e,s=i-r;a<i;a+=r)n+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return n},p}(),q=function(){function s(t){this.clipInfoID=-1,this._numEle=0,this._ref=1,this._key=new _t,void 0===t&&(t=1e4),this._renderType=t,this._id=++s.ID}l(s,"laya.webgl.submit.Submit");var t=s.prototype;return y.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){s.RENDERBASE!=this&&--this._ref<1&&((s.POOL[s._poolSize++]=this).shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=J.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),tt.activeBlendFunction!==this._blendFn&&(Y.setBlend(i,!0),this._blendFn(i),tt.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),g.renderBatch++,g.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,i,r){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=r*$.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,i){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},s.__init__=function(){var t=s.RENDERBASE=new s(-1);t.shaderValue=new P(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},s.create=function(t,e,i){var r=s._poolSize?s.POOL[--s._poolSize]:new s;r._ref=1,r._mesh=e,r._key.clear(),r._startIdx=e.indexNum*$.BYTES_PIDX,r._numEle=0;var n=t._nBlendType;r._blendFn=t._targets?tt.targetFns[n]:tt.fns[n],r.shaderValue=i,r.shaderValue.setValue(t._shader2D);var a=t._shader2D.filters;return a&&r.shaderValue.setFilters(a),r},s.createShape=function(t,e,i,r){var n=s._poolSize?s.POOL[--s._poolSize]:new s;n._mesh=e,n._numEle=i,n._startIdx=2*e.indexNum,n._ref=1,n.shaderValue=r,n.shaderValue.setValue(t._shader2D);var a=t._nBlendType;return n._key.blendShader=a,n._blendFn=t._targets?tt.targetFns[a]:tt.fns[a],n},s.TYPE_2D=1e4,s.TYPE_CANVAS=10003,s.TYPE_CMDSETRT=10004,s.TYPE_CUSTOM=10005,s.TYPE_BLURRT=10006,s.TYPE_CMDDESTORYPRERT=10007,s.TYPE_DISABLESTENCIL=10008,s.TYPE_OTHERIBVB=10009,s.TYPE_PRIMITIVE=10010,s.TYPE_RT=10011,s.TYPE_BLUR_RT=10012,s.TYPE_TARGET=10013,s.TYPE_CHANGE_VALUE=10014,s.TYPE_SHAPE=10015,s.TYPE_TEXTURE=10016,s.TYPE_FILLTEXTURE=10017,s.KEY_ONCE=-1,s.KEY_FILLRECT=1,s.KEY_DRAWTEXTURE=2,s.KEY_VG=3,s.KEY_TRIANGLES=4,s.RENDERBASE=null,s.ID=1,s.preRender=null,s._poolSize=0,s.POOL=[],s}(),$=function(){function t(){}return l(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}(),J=function(){function s(){}return l(s,"laya.webgl.WebGL"),s._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},s._uint16ArraySlice=function(t){var e,i=arguments,r=0,n=0;if(0===i.length)for(r=this.length,e=new Uint16Array(r),n=0;n<r;n++)e[n]=this[n];else if(2===i.length){var a=i[0],s=i[1];if(a<s)for(r=s-a,e=new Uint16Array(r),n=a;n<s;n++)e[n-a]=this[n];else e=new Uint16Array(0)}return e},s._nativeRender_enable=function(){s.isNativeRender_enable||(s.isNativeRender_enable=!0,e.create=function(t,e){var i=new Ut(t,e,1,!1,!1);return i.wrapModeU=1,i.wrapModeV=1,i},Y.__init_native(),Ft.prototype.uploadTexture2D=function(t){var e=Y;e.bindTexture(laya.webgl.WebGL.mainContext,e.TEXTURE_2D,t)},ct.width=u.window.innerWidth,ct.height=u.window.innerHeight,n.measureText=function(t,e){return d.conchTextCanvas.font=e,d.conchTextCanvas.measureText(t)},n.enableNative=function(){C.supportWebGLPlusRendering&&(G.uploadShaderUniforms=G.uploadShaderUniformsForNative,at=d.GLCommandEncoder,O=d.LayaGLContext);var t=v;t.prototype.render=t.prototype.renderToNative,C.isConchApp&&ft.rewriteProperties()},n.clear=function(t){var e=p.create(t).arrColor,i=O.instance;e&&i.clearColor(e[0],e[1],e[2],e[3]),i.clear(17664)},n.drawToCanvas=function(t,e,i,r,n,a){n-=t.x,a-=t.y,n|=0,a|=0,i|=0,r|=0;var s=new m(!1),o=s.getContext("2d");return s.size(i,r),o.asBitmap=!0,o._targets.start(),x.renders[e]._fun(t,o,n,a),o.flush(),o._targets.end(),o._targets.restore(),s},Nt.prototype.getData=function(t,e,i,r,n){var a=O.instance;a.bindFramebuffer(36160,this._frameBuffer),a.readPixelsAsync(t,e,i,r,6408,5121,function(t){n(t)}),a.bindFramebuffer(36160,null)},Nt.prototype._uv=Nt.flipyuv,Object.defineProperty(Nt.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}}),m.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=Nt.flipyuv,this._texture.bitmap=this._texture),this._texture})},s._webglRender_enable=function(){C.isWebGL||(C.isWebGL=!0,n.initRender=function(t,e,i){var r=O.instance=laya.webgl.WebGL.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];c.useWebGL2||i.shift();for(var r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:c.isStencil,alpha:c.isAlpha,antialias:c.isAntialias,premultipliedAlpha:c.premultipliedAlpha,preserveDrawingBuffer:c.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[r]&&(laya.webgl.WebGL._isWebGL2=!0),new O,e}return null}(C._mainCanvas.source);if(!r)return!1;t.size(e,i),Y.__init__(r),xt.__init__(),q.__init__();var n=new xt;C._context=n,t._setContext(n),laya.webgl.WebGL.shaderHighPrecision=!1;try{var a=r.getShaderPrecisionFormat(35632,36338);s.shaderHighPrecision=!!a.precision}catch(t){}return O.instance=r,b.__init__(),Et.__init__(),P.__init__(),nt.__init__(),Ct.__int__(r),tt._init_(r),!0},e.create=function(t,e,i){var r=new Ut(t,e,i,!1,!1);return r.wrapModeU=1,r.wrapModeV=1,r},n.createRenderSprite=function(t,e){return new mt(t,e)},n.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},n.clear=function(t){xt.set2DRenderConfig(),ct.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=C.context,i=0==e._submits._length||c.preserveDrawingBuffer?p.create(t).arrColor:y.stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),ct.clear()},n.drawToCanvas=function(t,e,i,r,n,a){n-=t.x,a-=t.y,n|=0,a|=0,i|=0,r|=0;var s=new xt;s.size(i,r),s.asBitmap=!0,s._targets.start(),x.renders[e]._fun(t,s,n,a),s.flush(),s._targets.end(),s._targets.restore();var o=s._targets.getData(0,0,i,r);s.destroy();for(var h=new ImageData(i,r),l=4*i,u=(new Uint8Array(l),h.data),c=r-1,_=c*l,f=0;0<=c;c--)u.set(o.subarray(f,f+l),_),_-=l,f+=l;var d=new m(!0);return d.size(i,r),d.getContext("2d").putImageData(h,0,0),d},n.getTexturePixels=function(t,e,i,r,n){var a=0,s=0,o=0,h=t.bitmap,l=h.width,u=h.height;if(l<e+r&&(r-=e+r-l),u<i+n&&(n-=i+n-u),r<=0||n<=0)return null;var c=4*r,_=null;try{_=h.getPixels()}catch(t){}if(_){if(0==e&&0==i&&r==l&&n==u)return _;var f=new Uint8Array(r*n*4);for(s=(i+n-1)*(c=4*l)+(a=4*e),o=n-1;0<=o;o--)f.set(T.slice(s,s+4*r),a),a+=c,s-=c;return f}var d=new xt;d.size(r,n),d.asBitmap=!0;var p=null;if(0!=e||0!=i||r!=l||n!=u){var m=(p=t.uv.concat())[0],x=p[1],v=(p[2]-m)/l,g=(p[7]-x)/u;p=[m+e*v,x+i*g,m+(e+r)*v,x+i*g,m+(e+r)*v,x+(i+n)*g,m+e*v,x+(i+n)*g]}d._drawTextureM(t,0,0,r,n,null,1,p),d._targets.start(),d.flush(),d._targets.end(),d._targets.restore();var T=d._targets.getData(0,0,r,n);for(d.destroy(),f=new Uint8Array(r*n*4),a=0,s=(n-1)*c,o=n-1;0<=o;o--)f.set(T.slice(s,s+c),a),a+=c,s-=c;return f},t._filter=function(t,e,i,r){var n=e,a=this._next;if(a){var s=t.filters,o=s.length;if(1==o&&32==s[0].type)return e.save(),e.setColorFilter(s[0]),a._fun.call(a,t,e,i,r),void e.restore();var h,l=P.create(1,0),u=M.TEMP,c=n._curMat,_=R.create();c.copyTo(_);var f=0,d=0,p=null,m=t._cacheStyle.filterCache||null;if(m&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(f=50,d=25),(h=t.getBounds()).width<=0||h.height<=0)return;h.width+=f,h.height+=f,u.x=h.x*_.a+h.y*_.c,u.y=h.y*_.d+h.x*_.b,h.x=u.x,h.y=u.y,u.x=h.width*_.a+h.height*_.c,u.y=h.height*_.d+h.width*_.b,h.width=u.x,h.height=u.y}else{t._isHaveGlowFilter()&&(f=50,d=25),(h=new S).copyFrom(t.getSelfBounds()),h.x+=t.x,h.y+=t.y,h.x-=t.pivotX+4,h.y-=t.pivotY+4;var x=h.x,v=h.y;if(h.width+=f+8,h.height+=f+8,u.x=h.x*_.a+h.y*_.c,u.y=h.y*_.d+h.x*_.b,h.x=u.x,h.y=u.y,u.x=h.width*_.a+h.height*_.c,u.y=h.height*_.d+h.width*_.b,h.width=u.x,h.height=u.y,h.width<=0||h.height<=0)return;m&&ut.releaseRT(m),p=ut.getRT(h.width,h.height);var g=m=ut.getRT(h.width,h.height);t._getCacheStyle().filterCache=m,n.pushRT(),n.useRT(p);var T=t.x-x+d,b=t.y-v+d;a._fun.call(a,t,e,T,b),n.useRT(g);for(var y=0;y<o;y++){0!=y&&(n.useRT(p),n.drawTarget(g,0,0,h.width,h.height,R.TEMP.identity(),l,null,tt.TOINT.overlay),n.useRT(g));var A=s[y];switch(A.type){case 16:case 8:A._glRender&&A._glRender.render(p,e,h.width,h.height,A);break;case 32:n.setColorFilter(A),n.drawTarget(p,0,0,h.width,h.height,R.EMPTY.identity(),P.create(1,0)),n.setColorFilter(null)}}n.popRT()}if(i=i-d-t.x,r=r-d-t.y,u.setTo(i,r),_.transformPoint(u),i=u.x+h.x,r=u.y+h.y,n._drawRenderTexture(m,i,r,h.width,h.height,R.TEMP.identity(),1,Nt.defuv),p){var E=dt.create([p],function(t){t.destroy()},this);p=null,e.addRenderObject(E)}_.destroy()}},m.prototype.getTexture=function(){if(!this._texture){var t=new Ut;t.loadImageSource(this.source),this._texture=new A(t)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=s._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=s._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=s._uint8ArraySlice))},s.enable=function(){return u.__init__(),!!u._supportWebGL&&(s._webglRender_enable(),C.isConchApp&&s._nativeRender_enable(),!0)},s.onStageResize=function(t,e){null!=s.mainContext&&(s.mainContext.viewport(0,0,t,e),ct.width=t,ct.height=e)},s.mainContext=null,s.shaderHighPrecision=!1,s._isWebGL2=!1,s.isNativeRender_enable=!1,s}(),tt=function(){function e(){}return l(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){Y.setBlendFunc(t,1,771)},e.BlendAdd=function(t){Y.setBlendFunc(t,1,772)},e.BlendMultiply=function(t){Y.setBlendFunc(t,774,771)},e.BlendScreen=function(t){Y.setBlendFunc(t,1,1)},e.BlendOverlay=function(t){Y.setBlendFunc(t,1,769)},e.BlendLight=function(t){Y.setBlendFunc(t,1,1)},e.BlendNormalTarget=function(t){Y.setBlendFunc(t,1,771)},e.BlendAddTarget=function(t){Y.setBlendFunc(t,1,772)},e.BlendMultiplyTarget=function(t){Y.setBlendFunc(t,774,771)},e.BlendScreenTarget=function(t){Y.setBlendFunc(t,1,1)},e.BlendOverlayTarget=function(t){Y.setBlendFunc(t,1,769)},e.BlendLightTarget=function(t){Y.setBlendFunc(t,1,1)},e.BlendMask=function(t){Y.setBlendFunc(t,0,770)},e.BlendDestinationOut=function(t){Y.setBlendFunc(t,0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.LIGHT="light",e.MASK="mask",e.DESTINATIONOUT="destination-out",e.LIGHTER="lighter",e.fns=[],e.targetFns=[],e}(),et=function(){var r;function t(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}l(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new r,this._curPath.convex=t},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new r,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(t,e){this._curPath?0<this._curPath.path.length&&(this._curPath=new r,this.paths.push(this._curPath)):(this._curPath=new r,this.paths.push(this._curPath));var i=this._curPath;i.path=t.slice(),i.convex=e},e.reset=function(){this.paths.length=0},t.__init$=function(){r=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return l(t,""),t}()},t}(),it=function(){function t(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,this._glBuffer=O.instance.createBuffer()}l(t,"laya.webgl.utils.Buffer");var e=t.prototype;return e._bindForVAO=function(){},e.bind=function(){return!1},e.destroy=function(){this._glBuffer&&(O.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)},o(0,e,"bufferUsage",function(){return this._bufferUsage}),t._bindedVertexBuffer=null,t._bindedIndexBuffer=null,t}(),rt=function(){function a(){this._matrix=new R}l(a,"laya.webgl.canvas.save.SaveTransform");var t=a.prototype;return y.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,a.POOL[a.POOL._length++]=this},a.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=a.POOL,r=0<i._length?i[--i._length]:new a;r._savematrix=t._curMat,t._curMat=t._curMat.copyTo(r._matrix);var n=t._save;n[n._length++]=r}},a.POOL=I._createArray(),a}(),nt=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new Et,this.fillStyle=N.DEFAULT,this.strokeStyle=N.DEFAULT}return l(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null},t.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Ft.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",Ft.preCompile2D(0,4,t,e,null),t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\n\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = pos.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n\n#import?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n\n#import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_uniform;\n\n#import?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n\n#import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_uniform;\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   \n   #import?COLOR_ADD "parts/ColorAdd.glsl" with ColorAdd_ps_logic;\n   \n   #import?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   \n   #import?COLOR_FILTER "parts/ColorFilter.glsl" with ColorFilter_ps_logic;\n   \n   #import?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Ft.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Ft.preCompile2D(0,512,t,e,null)},t}(),at=function(){function t(t,e,i,r){this._idata=[]}l(t,"laya.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}(),st=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"===t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var n=z.splitToWords(t.substr(e,i-e),null);"code"==n[1]?this.codes[n[2]]=t.substr(i+1,r-i-1):"function"==n[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[n[3]]=t.substr(i+1,r-i-1),this.funnames+=n[3]+";"),e=r+1}}l(t,"laya.webgl.utils.InlcudeFile");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}(),ot=(function(){function t(t,e){this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._oldMesh=null,this._oldPathMesh=null,this._oldTriMesh=null,this._oldMeshList=null,this.oldTx=0,this.oldTy=0,this.cachedClipInfo=new R,this.invMat=new R,this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}l(t,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var e=t.prototype;e.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0,this._mesh=bt.getAMesh(),this._pathMesh=yt.getAMesh(),this._triangleMesh=At.getAMesh(),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=q.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()},e.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var e=this.submitEndPos-this.submitStartPos,i=0;i<e;i++)this.submits.push(t[this.submitStartPos+i]);t._length-=e,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=q.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null},e.isCacheValid=function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty},e.flushsubmit=function(){var e=q.RENDERBASE;this.submits.forEach(function(t){t!=q.RENDERBASE&&(q.preRender=e,(e=t).renderSubmit())})},e.releaseMem=function(){},s(t,["matI",function(){return this.matI=new R}])}(),function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return l(t,"laya.webgl.shapes.EarcutNode"),t}()),ht=function(){function D(){}return l(D,"laya.webgl.shapes.BasePoly"),D.createLine2=function(t,e,i,r,n,a){if(t.length<4)return null;var s=D.tempData.length>t.length+2?D.tempData:new Array(t.length+2);s[0]=t[0],s[1]=t[1];var o=2,h=0,l=t.length;for(h=2;h<l;h+=2).01<Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])&&(s[o++]=t[h],s[o++]=t[h+1]);a&&.01<Math.abs(t[0]-s[o-2])+Math.abs(t[1]-s[o-1])&&(s[o++]=t[0],s[o++]=t[1]);var u=n;l=o/2;var c,_,f,d,p,m,x,v,g,T,b,y,A,E,R,M,S,w,C,I,P=i/2;f=s[0],d=s[1],T=f-(p=s[2]);g=(g=-(d-(m=s[3])))/(I=Math.sqrt(g*g+T*T))*P,T=T/I*P;for(u.push(f-g,d-T,f+g,d+T),h=1;h<l-1;h++)f=s[2*(h-1)],d=s[2*(h-1)+1],p=s[2*h],m=s[2*h+1],x=s[2*(h+1)],v=s[2*(h+1)+1],T=f-p,y=p-x,R=(-(g=(g=-(d-m))/(I=Math.sqrt(g*g+T*T))*P)+f)*(-(T=T/I*P)+m)-(-g+p)*(-T+d),w=(-(b=(b=-(m-v))/(I=Math.sqrt(b*b+y*y))*P)+x)*(-(y=y/I*P)+m)-(-b+p)*(-y+v),C=(A=-T+d-(-T+m))*(S=-b+p-(-b+x))-(M=-y+v-(-y+m))*(E=-g+p-(-g+f)),Math.abs(C)<.1?(C+=10.1,u.push(p-g,m-T,p+g,m+T)):(((c=(E*w-S*R)/C)-p)*(c-p)+((_=(M*R-A*w)/C)-m)+(_-m),u.push(c,_,p-(c-p),m-(_-m)));for(f=s[o-4],d=s[o-3],T=f-(p=s[o-2]),g=(g=-(d-(m=s[o-1])))/(I=Math.sqrt(g*g+T*T))*P,T=T/I*P,u.push(p-g,m-T,p+g,m+T),h=1;h<l;h++)e.push(r+2*(h-1),r+2*(h-1)+1,r+2*h+1,r+2*h+1,r+2*h,r+2*(h-1));return u},D.createLineTriangle=function(t,e,i,r,n,a,s){var o=t.slice(),h=o.length,l=o[0],u=o[1],c=o[2],_=(o[2],0),f=0,d=0,p=0,m=h/2;if(!(m<=1)&&2!=m){for(var x=new Array(4*m),v=0,g=0,T=0;T<m-1;T++)l=o[g++],u=o[g++],c=o[g++],p=o[g++]-u,0!=(d=c-l)&&0!=p&&.001<(_=Math.sqrt(d*d+p*p))&&(x[f=4*v]=l,x[f+1]=u,x[f+2]=d/_,x[f+3]=p/_,v++);for(r?(l=o[h-2],u=o[h-1],c=o[0],p=o[1]-u,0!=(d=c-l)&&0!=p&&.001<(_=Math.sqrt(d*d+p*p))&&(x[f=4*v]=l,x[f+1]=u,x[f+2]=d/_,x[f+3]=p/_,v++)):(x[f=4*v]=l,x[f+1]=u,x[f+2]=d/_,x[f+3]=p/_,v++),T=g=0;T<m;T++){l=o[g],u=o[g+1],c=o[g+2],o[g+3];o[g+4],o[g+5]}}},s(D,["tempData",function(){return this.tempData=new Array(256)}]),D}(),lt=function(){function s(){this._data=[],this._ndata=0,this._tex=null,this._imgId=0,this._clipid=-1,this._enbale=!1,this._colorFiler=null,this._clipMatrix=new R}l(s,"laya.webgl.text.CharSubmitCache");var t=s.prototype;return t.clear=function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null},t.destroy=function(){this.clear(),this._data.length=0,this._data=null},t.add=function(t,e,i,r,n,a){0<this._ndata&&(this._tex!=e||this._imgId!=i||0<=this._clipid&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=r,this._data[this._ndata+1]=n,this._data[this._ndata+2]=a,this._ndata+=3},t.getPos=function(){return 0==s.__nPosPool?new Array(8):s.__posPool[--s.__nPosPool]},t.enable=function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))},t.submit=function(t){var e=this._ndata;if(e){var i=t._mesh,r=t._colorFiler;t._colorFiler=this._colorFiler;var n=It.create(t,i,P.create(1,0));t._submits[t._submits._length++]=t._curSubmit=n,n.shaderValue.textureHost=this._tex,n._key.other=this._imgId,t._colorFiler=r,t._copyClipInfo(n,this._clipMatrix),n.clipInfoID=this._clipid;for(var a=0;a<e;a+=3)i.addQuad(this._data[a],this._data[a+1],this._data[a+2],!0),s.__posPool[s.__nPosPool++]=this._data[a];e/=3,n._numEle+=6*e,i.indexNum+=6*e,i.vertNum+=4*e,t._drawCount+=e,this._ndata=0,g.loopCount%100==0&&(this._data.length=0)}},s.__posPool=[],s.__nPosPool=0,s}(),ut=function(){function a(){}return l(a,"laya.webgl.resource.WebGLRTMgr"),a.getRT=function(t,e){e|=0,1e4<=(t|=0)&&console.error("getRT error! w too big");var i,r=1e4*e+t,n=a.dict[r];return n&&0<n.length?(i=n.pop())._mgrKey=r:(i=new Nt(t,e,1,-1))._mgrKey=r,i},a.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=a.dict[t._mgrKey];!e&&(e=[],a.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},a.dict={},a}(),ct=function(){function n(){}return l(n,"laya.webgl.utils.RenderState2D"),n.mat2MatArray=function(t,e){var i=t,r=e;return r[0]=i.a,r[1]=i.b,r[2]=n.EMPTYMAT4_ARRAY[2],r[3]=n.EMPTYMAT4_ARRAY[3],r[4]=i.c,r[5]=i.d,r[6]=n.EMPTYMAT4_ARRAY[6],r[7]=n.EMPTYMAT4_ARRAY[7],r[8]=n.EMPTYMAT4_ARRAY[8],r[9]=n.EMPTYMAT4_ARRAY[9],r[10]=n.EMPTYMAT4_ARRAY[10],r[11]=n.EMPTYMAT4_ARRAY[11],r[12]=i.tx,r[13]=i.ty,r[14]=n.EMPTYMAT4_ARRAY[14],r[15]=n.EMPTYMAT4_ARRAY[15],e},n.restoreTempArray=function(){n.TEMPMAT4_ARRAY[0]=1,n.TEMPMAT4_ARRAY[1]=0,n.TEMPMAT4_ARRAY[4]=0,n.TEMPMAT4_ARRAY[5]=1,n.TEMPMAT4_ARRAY[12]=0,n.TEMPMAT4_ARRAY[13]=0},n.clear=function(){n.worldScissorTest=!1,n.worldAlpha=1},n._MAXSIZE=99999999,n.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.worldMatrix4=n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.matWVP=null,n.worldAlpha=1,n.worldScissorTest=!1,n.worldShaderDefines=null,n.worldFilters=null,n.width=0,n.height=0,s(n,["worldMatrix",function(){return this.worldMatrix=new R}]),n}(),_t=(function(){function n(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}l(n,"laya.layagl.QuickTestTool");var t=n.prototype;t.render=function(t,e,i){n._addType(this._renderType),n.showRenderTypeInfo(this._renderType),x.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t._stageRender=function(t,e,i){n._countStart(),n._PreStageRender.call(y.stage,t,e,i),n._countEnd()},n.getMCDName=function(t){return n._typeToNameDic[t]},n.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!n.showedDic[t]){if(n.showedDic[t]=!0,!n._rendertypeToStrDic[t]){var i=[],r=0;for(r=1;r<=t;)r&t&&i.push(n.getMCDName(r&t)),r<<=1;n._rendertypeToStrDic[t]=i.join(",")}console.log("cmd:",n._rendertypeToStrDic[t])}},n.__init__=function(){n._typeToNameDic[1]="ALPHA",n._typeToNameDic[2]="TRANSFORM",n._typeToNameDic[256]="TEXTURE",n._typeToNameDic[512]="GRAPHICS",n._typeToNameDic[4096]="ONECHILD",n._typeToNameDic[8192]="CHILDS",n._typeToNameDic[3]="TRANSFORM|ALPHA",n._typeToNameDic[8]="CANVAS",n._typeToNameDic[4]="BLEND",n._typeToNameDic[16]="FILTERS",n._typeToNameDic[32]="MASK",n._typeToNameDic[64]="CLIP",n._typeToNameDic[1024]="LAYAGL3D"},n._countStart=function(){var t;for(t in n._countDic)n._countDic[t]=0},n._countEnd=function(){60<++n._i&&(n.showCountInfo(),n._i=0)},n._addType=function(t){n._countDic[t]?n._countDic[t]+=1:n._countDic[t]=1},n.showCountInfo=function(){var t;for(t in console.log("==================="),n._countDic)console.log("count:"+n._countDic[t]),n.showRenderTypeInfo(t,!0)},n.enableQuickTest=function(){n.__init__(),_.prototype.render=n.prototype.render,n._PreStageRender=v.prototype.render,v.prototype.render=n.prototype._stageRender},n.showedDic={},n._rendertypeToStrDic={},n._typeToNameDic={},n._PreStageRender=null,n._countDic={},n._i=0}(),function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}l(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}()),ft=function(){function t(){}return l(t,"laya.layagl.ConchPropertyAdpt"),t.rewriteProperties=function(){laya.layagl.ConchPropertyAdpt.rewriteNumProperty(S.prototype,"x"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(S.prototype,"y"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(S.prototype,"width"),laya.layagl.ConchPropertyAdpt.rewriteNumProperty(S.prototype,"height"),laya.layagl.ConchPropertyAdpt.rewriteFunc(S.prototype,"recover")},t.rewriteNumProperty=function(t,e){Object.defineProperty(t,e,{get:function(){return this["_"+e]||0},set:function(t){this["_"+e]=t,this.onPropertyChanged&&this.onPropertyChanged(this)}})},t.rewriteFunc=function(t,e){t["__"+e]=t[e],t[e]=function(){t["__"+e].call(this),this.onPropertyChanged&&(this.onPropertyChanged=null)}},t}(),dt=(function(){function t(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}l(t,"laya.webgl.resource.CharInternalTexture"),t.prototype._getSource=function(){return this._par._source}}(),function(){function n(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new _t}l(n,"laya.webgl.submit.SubmitCMD");var t=n.prototype;return y.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=n.POOL;t[t._length++]=this}},t.clone=function(t,e,i){return null},n.create=function(t,e,i){var r=n.POOL._length?n.POOL[--n.POOL._length]:new n;return r.fun=e,r.args=t,r._this=i,r._ref=1,r._key.clear(),r},n.POOL=((n.POOL=[])._length=0,n.POOL),n}()),pt=function(){function n(){this.texWidth=1024,this.texHeight=1024,this.atlasgrid=null,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=U.atlasWidth,this.texture=Dt.getTextTexture(this.texWidth,this.texHeight),256<this.texWidth/n.atlasGridW&&(n.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new L(this.texWidth/n.atlasGridW,this.texHeight/n.atlasGridW,this.texture.id)}l(n,"laya.webgl.text.TextAtlas");var t=n.prototype;return t.setProtecteDist=function(t){this.protectDist=t},t.getAEmpty=function(t,e,i){var r=this.atlasgrid.addRect(1,Math.ceil(t/n.atlasGridW),Math.ceil(e/n.atlasGridW),i);return r&&(i.x*=n.atlasGridW,i.y*=n.atlasGridW),r},t.destroy=function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()},t.printDebugInfo=function(){},o(0,t,"usedRate",function(){return this.atlasgrid._used}),n.atlasGridW=16,n}(),mt=function(t){function i(t,e){i.__super.call(this,t,e)}l(i,"laya.webgl.utils.RenderSprite3D",x);var e=i.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,i,r){var n=this._next,a=t.mask,s=e;if(a){s.save();var o=s.globalCompositeOperation,h=new S;if(h.copyFrom(a.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),0<h.width&&0<h.height){var l=h.width,u=h.height,c=ut.getRT(l,u);s.breakNextMerge(),s.pushRT(),s.addRenderObject(dt.create([s,c,l,u],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(s,-h.x,-h.y),s.breakNextMerge(),s.popRT(),s.save(),s.clipRect(i+h.x-t.getStyle().pivotX,r+h.y-t.getStyle().pivotY,l,u),n._fun.call(n,t,s,i,r),s.restore(),o=s.globalCompositeOperation,s.addRenderObject(dt.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var _=P.create(1,0),f=A.INV_UV;s.drawTarget(c,i+h.x-t.getStyle().pivotX,r+h.y-t.getStyle().pivotY,l,u,R.TEMP.identity(),_,f,6),s.addRenderObject(dt.create([c],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),s.addRenderObject(dt.create([o],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}s.restore()}else n._fun.call(n,t,e,i,r)},e._blend=function(t,e,i,r){var n=t._style,a=this._next;n.blendMode?(e.save(),e.globalCompositeOperation=n.blendMode,a._fun.call(a,t,e,i,r),e.restore()):a._fun.call(a,t,e,i,r)},i.tmpTarget=function(t,e,i,r){e.start(),e.clear(0,0,0,0)},i.recycleTarget=function(t){ut.releaseRT(t)},i.setBlendMode=function(t){var e=J.mainContext;tt.targetFns[tt.TOINT[t]](e)},s(i,["tempUV",function(){return this.tempUV=new Array(8)}]),i}(),xt=function(t){var i;function X(){if(this._drawTriUseAbsMatrix=!1,this._id=++X._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this.meshlist=[],this._clipInfoID=0,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._saveMark=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.drawTexAlign=!1,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,X.__super.call(this),this._width=99999999,this._height=99999999,this._submitKey=new _t,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=X.MAXCLIPRECT,this._globalClipMatrix=new R(99999999,0,0,99999999,0,0),this._shader2D=new nt,this.mOutPoint,X._contextcount++,!X.defTexture){var t=new Ut(2,2);t.setPixels(new Uint8Array(16)),X.defTexture=new A(t)}this._lastTex=X.defTexture,this.clear()}l(X,"laya.webgl.canvas.WebGLContext2D",w);var e=X.prototype;return e.clearBG=function(t,e,i,r){var n=J.mainContext;n.clearColor(t,e,i,r),n.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var i;for(t=0,i=this.meshlist.length;t<i;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},e.destroy=function(){--X._contextcount,this.sprite=null,this._releaseMem(),this._charSubmitCache.destroy(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=R.create(),this._charSubmitCache=new lt,this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=yt.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=At.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[V.Create(this)],this._save.length=10,this._shader2D=new nt),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=i.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=X.MAXCLIPRECT,this._curSubmit=q.RENDERBASE,q.RENDERBASE._ref=16777215,q.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=N.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new Nt(t,e,1,-1)),C._context==this&&(J.mainContext.viewport(0,0,t,e),ct.width=t,ct.height=e)),0===t&&0===e&&this._releaseMem()},e.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b||(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b),this._lastMatScaleX},e.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d||(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d),this._lastMatScaleY},e.setFillColor=function(t){this._fillColor=t},e.getFillColor=function(){return this._fillColor},e.translate=function(t,e){0===t&&0===e||(K.save(this),this._curMat._bTransform?(rt.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},e.save=function(){this._save[this._save._length++]=V.Create(this)},e.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;0<=i;i--){var r=this._save[i];if(r.restore(this),r.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=q.RENDERBASE)}},e.fillText=function(t,e,i,r,n,a){this._fillText(t,null,e,i,r,n,null,0,null)},e._fillText=function(t,e,i,r,n,a,s,o,h,l){void 0===l&&(l=0),t?X._textRender.filltext(this,t,i,r,n,a,s,o,h,l):e&&X._textRender.fillWords(this,e,i,r,n,a,s,o)},e._fast_filltext=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=0),X._textRender._fast_filltext(this,t,null,e,i,r,n,a,s,o,h)},e.fillWords=function(t,e,i,r,n){this._fillText(null,t,e,i,r,n,null,-1,null,0)},e.fillBorderWords=function(t,e,i,r,n,a,s){this._fillBorderText(null,t,e,i,r,n,a,s,null)},e.drawText=function(t,e,i,r,n,a){this._fillText(t,null,e,i,r,p.create(n).strColor,null,-1,a)},e.strokeWord=function(t,e,i,r,n,a,s){this._fillText(t,null,e,i,r,null,p.create(n).strColor,a||1,s)},e.fillBorderText=function(t,e,i,r,n,a,s,o){this._fillBorderText(t,null,e,i,r,p.create(n).strColor,p.create(a).strColor,s,o)},e._fillBorderText=function(t,e,i,r,n,a,s,o,h){this._fillText(t,e,i,r,n,a,s,o||1,h)},e._fillRect=function(t,e,i,r,n){var a=this._curSubmit,s=a&&2===a._key.submitType&&a._key.blendShader===this._nBlendType;65535<this._mesh.vertNum+4&&(this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh),s=!1),s&&(s=s&&this.isSameClipInfo(a)),this.transformQuad(t,e,i,r,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,A.NO_UV,n,!1),s||(a=this._curSubmit=It.create(this,this._mesh,P.create(1,0)),this._submits[this._submits._length++]=a,this._copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e.fillRect=function(t,e,i,r,n){var a=n?N.create(n):this._shader2D.fillStyle,s=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,r,s)},e.fillTexture=function(t,e,i,r,n,a,s,o){if(t._getSource()){var h=this._curSubmit;65535<this._mesh.vertNum+4&&(this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh),!1);t.bitmap;var l=!0,u=!0;switch(a){case"repeat":break;case"repeat-x":u=!1;break;case"repeat-y":l=!1;break;case"no-repeat":l=u=!1}var c=this._temp4Points,_=0,f=0,d=0,p=0,m=0,x=0;if(s.x<0?(d=e,_=-s.x%t.width/t.width):d=e+s.x,s.y<0?(p=i,f=-s.y%t.height/t.height):p=i+s.y,m=e+r,x=i+n,!l&&(m=Math.min(m,e+s.x+t.width)),!u&&(x=Math.min(x,i+s.y+t.height)),!(m<e||x<i||m<d||x<p)){var v=(m-e-s.x)/t.width,g=(x-i-s.y)/t.height;if(this.transformQuad(d,p,m-d,x-p,0,this._curMat,this._transedPoints),c[0]=_,c[1]=f,c[2]=v,c[3]=f,c[4]=v,c[5]=g,c[6]=_,c[7]=g,!this.clipedOff(this._transedPoints)){var T=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,c,T,!0);var b=P.create(1,0);b.defines.add(256),b.u_TexRange=t.uvrect,h=this._curSubmit=It.create(this,this._mesh,b),this._submits[this._submits._length++]=h,this._copyClipInfo(h,this._globalClipMatrix),h.shaderValue.textureHost=t,h._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}}else this.sprite&&y.systemTimer.callLater(this,this._repaintSprite)},e.setColorFilter=function(t){I.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=q.RENDERBASE},e.drawTexture=function(t,e,i,r,n){this._drawTextureM(t,e,i,r,n,null,1,null)},e.drawTextures=function(t,e,i,r){if(t._getSource())for(var n=e.length/2,a=0,s=0;s<n;s++)this._inner_drawTexture(t,t.bitmap.id,e[a++]+i,e[a++]+r,0,0,null,null,1,!1);else this.sprite&&y.systemTimer.callLater(this,this._repaintSprite)},e._drawTextureAddSubmit=function(t,e){var i=null;i=It.create(this,this._mesh,P.create(1,0)),(this._submits[this._submits._length++]=i).shaderValue.textureHost=e,i._key.other=t,i._renderType=10016,this._curSubmit=i},e._drawTextureM=function(t,e,i,r,n,a,s,o){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,i,r,n,a,o,s,!1):(this.sprite&&y.systemTimer.callLater(this,this._repaintSprite),!1)},e._drawRenderTexture=function(t,e,i,r,n,a,s,o){return this._inner_drawTexture(t,-1,e,i,r,n,a,o,1,!1)},e.submitDebugger=function(){this._submits[this._submits._length++]=dt.create([],function(){},this)},e._copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var r=t.shaderValue.clipMatPos;r[0]=e.tx,r[1]=e.ty,t.clipInfoID=this._clipInfoID},e.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},e._useNewTex2DSubmit=function(t,e){65535<this._mesh.vertNum+e&&(this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh));var i=It.create(this,this._mesh,P.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)},e._drawTexRect=function(t,e,i,r,n){this.transformQuad(t,e,i,r,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,n,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},e.drawCallOptimize=function(t){return this._charSubmitCache.enable(t,this),t},e._inner_drawTexture=function(t,e,i,r,n,a,s,o,h,l){var u=this._curSubmit._key;if(o=o||t._uv,4===u.submitType&&u.other===e){var c=X._drawTexToDrawTri_Vert;return c[0]=i,c[1]=r,c[2]=i+n,c[3]=r,c[4]=i+n,c[5]=r+a,c[6]=i,c[7]=r+a,this._drawTriUseAbsMatrix=!0,this.drawTriangles(t,0,0,c,o,X._drawTexToDrawTri_Index,s,h,null,"normal"),!(this._drawTriUseAbsMatrix=!1)}var _=l?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(i,r,n||t.width,a||t.height,this._italicDeg,s||this._curMat,_),this.drawTexAlign&&(_[0]=Math.round(_[0]),_[1]=Math.round(_[1]),_[2]=Math.round(_[2]),_[3]=Math.round(_[3]),_[4]=Math.round(_[4]),_[5]=Math.round(_[5]),_[6]=Math.round(_[6]),_[7]=Math.round(_[7]),this.drawTexAlign=!1);var f=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(l)return this._charSubmitCache.add(this,t,e,_,o,f),!0;this._drawCount++;var d=0<=e&&2===u.submitType&&u.other===e;if(d&&(d=d&&this.isSameClipInfo(this._curSubmit)),this._lastTex=t,65535<this._mesh.vertNum+4&&(this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh),d=!1),this.clipedOff(this._transedPoints))return!1;if(this._mesh.addQuad(_,o,f,!0),!d){var p=It.create(this,this._mesh,P.create(1,0));this._submits[this._submits._length++]=this._curSubmit=p,p.shaderValue.textureHost=t,p._key.other=e,this._copyClipInfo(p,this._globalClipMatrix)}return this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,!0},e.transform4Points=function(t,e,i){var r=e.tx,n=e.ty;e._bTransform?(i[0]=t[0]*e.a+t[1]*e.c+r,i[1]=t[0]*e.b+t[1]*e.d+n,i[2]=t[2]*e.a+t[3]*e.c+r,i[3]=t[2]*e.b+t[3]*e.d+n,i[4]=t[4]*e.a+t[5]*e.c+r,i[5]=t[4]*e.b+t[5]*e.d+n,i[6]=t[6]*e.a+t[7]*e.c+r,i[7]=t[6]*e.b+t[7]*e.d+n):(i[0]=t[0]+r,i[1]=t[1]+n,i[2]=t[2]+r,i[3]=t[3]+n,i[4]=t[4]+r,i[5]=t[5]+n,i[6]=t[6]+r,i[7]=t[7]+n)},e.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},e.transformQuad=function(t,e,i,r,n,a,s){var o=0;0!=n&&(o=Math.tan(n*Math.PI/180)*r);var h=t+i,l=e+r;this._temp4Points[0]=t+o,this._temp4Points[1]=e,this._temp4Points[2]=h+o,this._temp4Points[3]=e,this._temp4Points[4]=h,this._temp4Points[5]=l,this._temp4Points[6]=t,this._temp4Points[7]=l,this.transform4Points(this._temp4Points,a,s)},e.pushRT=function(){this.addRenderObject(dt.create(null,Nt.pushRT,this))},e.popRT=function(){this.addRenderObject(dt.create(null,Nt.popRT,this)),this.breakNextMerge()},e.useRT=function(t){this.addRenderObject(dt.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},e.RTRestore=function(t){this.addRenderObject(dt.create([t],function(t){t.restore()},this)),this.breakNextMerge()},e.breakNextMerge=function(){this._curSubmit=q.RENDERBASE},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e.drawTextureWithTransform=function(t,e,i,r,n,a,s,o,h,l,u){var c=null;l&&(c=this.globalCompositeOperation,this.globalCompositeOperation=l);var _=this._colorFiler;if(u&&this.setColorFilter(u),!a)return this._drawTextureM(t,e+s,i+o,r,n,null,h,null),l&&(this.globalCompositeOperation=c),void(u&&this.setColorFilter(_));var f=this._curMat;X._tmpMatrix.a=a.a,X._tmpMatrix.b=a.b,X._tmpMatrix.c=a.c,X._tmpMatrix.d=a.d,X._tmpMatrix.tx=a.tx+s,X._tmpMatrix.ty=a.ty+o,X._tmpMatrix._bTransform=a._bTransform,a&&f._bTransform?(R.mul(X._tmpMatrix,f,X._tmpMatrix),(a=X._tmpMatrix)._bTransform=!0):a=X._tmpMatrix,this._drawTextureM(t,e,i,r,n,a,h,null),l&&(this.globalCompositeOperation=c),u&&this.setColorFilter(_)},e._flushToTarget=function(t,e){ct.worldScissorTest=!1,J.mainContext.disable(3089);var i=ct.worldAlpha,r=ct.worldMatrix4,n=ct.worldMatrix;ct.worldShaderDefines;ct.worldMatrix=R.EMPTY,ct.restoreTempArray(),ct.worldMatrix4=ct.TEMPMAT4_ARRAY,ct.worldAlpha=1,Pt.activeShader=null,e.start(),0<t._submits._length&&e.clear(0,0,0,0),t._curSubmit=q.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=q.RENDERBASE,Pt.activeShader=null,ct.worldAlpha=i,ct.worldMatrix4=r,ct.worldMatrix=n},e.drawCanvas=function(t,e,i,r,n){if(t){var a,s=t.context;if(s._targets)0<s._submits._length&&(a=dt.create([s,s._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(s._targets,e,i,r,n,null,1,Nt.flipyuv),this._curSubmit=q.RENDERBASE;else{var o=t;o.touches&&o.touches.forEach(function(t){t.touch()}),a=wt.create(t,this._shader2D.ALPHA,this._shader2D.filters),(this._submits[this._submits._length++]=a)._key.clear();var h=a._matrix;this._curMat.copyTo(h);var l=h.tx,u=h.ty;h.tx=h.ty=0,h.transformPoint(M.TEMP.setTo(e,i)),h.translate(M.TEMP.x+l,M.TEMP.y+u),R.mul(o.invMat,h,h),this._curSubmit=q.RENDERBASE}}},e.drawTarget=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(65535<this._mesh.vertNum+4&&(this._mesh=bt.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,r,n,0,a||this._curMat,this._transedPoints),this.clipedOff(this._transedPoints))return this._curSubmit=q.RENDERBASE,!1;this._mesh.addQuad(this._transedPoints,o||A.DEF_UV,4294967295,!0);var l=this._curSubmit=Z.create(this,this._mesh,s,t);return l.blendType=-1==h?this._nBlendType:h,this._copyClipInfo(l,this._globalClipMatrix),l._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._maxNumEle=Math.max(this._maxNumEle,l._numEle),this._submits[this._submits._length++]=l,this._curSubmit=q.RENDERBASE,!0},e.drawTriangles=function(t,e,i,r,n,a,s,o,h,l){if(t._getSource()){this._drawCount++;var u=null,c=!1;h&&(u=this._colorFiler,this._colorFiler=h,this._curSubmit=q.RENDERBASE,c=u!=h);var _=t.bitmap,f=this._curSubmit._key,d=4===f.submitType&&f.other===_.id&&f.blendShader==this._nBlendType,p=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o),m=r.length/2,x=a.length;if(65535<this._triangleMesh.vertNum+m&&(this._triangleMesh=At.getAMesh(),this.meshlist.push(this._triangleMesh),d=!1),!d){var v=this._curSubmit=It.create(this,this._triangleMesh,P.create(1,0));v.shaderValue.textureHost=t,v._renderType=10016,v._key.submitType=4,v._key.other=_.id,this._copyClipInfo(v,this._globalClipMatrix),this._submits[this._submits._length++]=v}X._tmpMatrix.ty=s?(X._tmpMatrix.a=s.a,X._tmpMatrix.b=s.b,X._tmpMatrix.c=s.c,X._tmpMatrix.d=s.d,X._tmpMatrix.tx=s.tx+e,s.ty+i):(X._tmpMatrix.a=1,X._tmpMatrix.b=0,X._tmpMatrix.c=0,X._tmpMatrix.d=1,X._tmpMatrix.tx=e,i),this._drawTriUseAbsMatrix||R.mul(X._tmpMatrix,this._curMat,X._tmpMatrix),this._triangleMesh.addData(r,n,a,X._tmpMatrix,p,this),this._curSubmit._numEle+=x,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),c&&(this._colorFiler=u,this._curSubmit=q.RENDERBASE)}else this.sprite&&y.systemTimer.callLater(this,this._repaintSprite)},e.transform=function(t,e,i,r,n,a){rt.save(this),R.mul(R.TEMP.setTo(t,e,i,r,n,a),this._curMat,this._curMat),this._curMat._checkTransform()},e._transformByMatrix=function(t,e,i){t.setTranslate(e,i),R.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.rotate=function(t){rt.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){rt.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,r){B.save(this),this._clipRect==X.MAXCLIPRECT?this._clipRect=new S(t,e,i,r):(this._clipRect.width=i,this._clipRect.height=r,this._clipRect.x=t,this._clipRect.y=e),X._clipID_Gen++,X._clipID_Gen%=1e4,this._clipInfoID=X._clipID_Gen;var n=this._globalClipMatrix,a=n.tx,s=n.ty,o=a+n.a,h=s+n.d;if(99999999<=this._clipRect.width?(n.a=n.d=99999999,n.b=n.c=n.tx=n.ty=0):this._curMat._bTransform?(n.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,n.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,n.a=this._clipRect.width*this._curMat.a,n.b=this._clipRect.width*this._curMat.b,n.c=this._clipRect.height*this._curMat.c,n.d=this._clipRect.height*this._curMat.d):(n.tx=this._clipRect.x+this._curMat.tx,n.ty=this._clipRect.y+this._curMat.ty,n.a=this._clipRect.width,n.b=n.c=0,n.d=this._clipRect.height),0<n.a&&0<n.d){var l=n.tx+n.a,u=n.ty+n.d;l<=a||u<=s||n.tx>=o||n.ty>=h?(n.a=-.1,n.d=-.1):(n.tx<a&&(n.a-=a-n.tx,n.tx=a),o<l&&(n.a-=l-o),n.ty<s&&(n.d-=s-n.ty,n.ty=s),h<u&&(n.d-=u-h),n.a<=0&&(n.a=-.1),n.d<=0&&(n.d=-.1))}},e.drawMesh=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=0)},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.submitElement=function(t,e){C._context;var i=this._submits,r=i._length;e<0&&(e=i._length);for(var n=q.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==q.RENDERBASE?(q.preRender=n,t+=(n=i[t]).renderSubmit()):t++;return r},e.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),D.instance&&D.getInstance().reset(),this._curSubmit=q.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var r=this.meshlist[e];r.canReuse?r.releaseMesh():r.destroy()}if(this.meshlist.length=0,this._mesh=bt.getAMesh(),this._pathMesh=yt.getAMesh(),this._triangleMesh=At.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&C._context==this){var n=y.textRender;n&&n.GC(!1)}return t},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=E.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},e.closePath=function(){this._path.closePath()},e.addPath=function(t,e,i,r,n){for(var a=0,s=0,o=t.length/2;s<o;s++){var h=t[a]+r,l=t[a+1]+n;t[a]=h,t[a+1]=l,a+=2}this._getPath().push(t,i)},e.fill=function(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n,a=this.mixRGBandAlpha(this.fillStyle.toInt()),s=0,o=0,h=e.paths.length;o<h;o++){var l=e.paths[o],u=l.path.length/2;if(!(u<3||3==u&&!l.convex)){var c=l.path.concat(),_=0,f=0,d=0,p=NaN,m=NaN;if(t._bTransform)for(_=0;_<u;_++)d=(f=_<<1)+1,p=c[f],m=c[d],c[f]=t.a*p+t.c*m+t.tx,c[d]=t.b*p+t.d*m+t.ty;else for(_=0;_<u;_++)d=(f=_<<1)+1,p=c[f],m=c[d],c[f]=p+t.tx,c[d]=m+t.ty;65535<this._pathMesh.vertNum+u&&(this._curSubmit._numEle+=s,s=0,this._pathMesh=yt.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var x=this._pathMesh.vertNum;if(l.convex){var v=u-2;n=new Array(3*v);for(var g=0,T=0;T<v;T++)n[g++]=x,n[g++]=T+1+x,n[g++]=T+2+x}else if(n=Q.earcut(c,null,2),0<x)for(var b=0;b<n.length;b++)n[b]+=x;this._pathMesh.addVertAndIBToMesh(this,c,a,n),s+=n.length}}this._curSubmit._numEle+=s},e.addVGSubmit=function(t){var e=q.createShape(this,t,0,P.create(4,0));return e._key.submitType=3,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e},e.stroke=function(){if(0<this.lineWidth){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n=0,a=0,s=e.paths.length;a<s;a++){var o=e.paths[a];if(!(o.path.length<=0)){var h=[],l=[],u=2*o.path.length;if(!(u<2)){65535<this._pathMesh.vertNum+u&&(this._curSubmit._numEle+=n,n=0,this._pathMesh=yt.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),ht.createLine2(o.path,h,this.lineWidth,this._pathMesh.vertNum,l,o.loop);var c=l.length/2,_=this._curMat,f=0,d=0,p=0,m=NaN,x=NaN;if(_._bTransform)for(f=0;f<c;f++)p=(d=f<<1)+1,m=l[d],x=l[p],l[d]=_.a*m+_.c*x+_.tx,l[p]=_.b*m+_.d*x+_.ty;else for(f=0;f<c;f++)p=(d=f<<1)+1,m=l[d],x=l[p],l[d]=m+_.tx,l[p]=x+_.ty;this._pathMesh.addVertAndIBToMesh(this,l,t,h),n+=h.length}}}this._curSubmit._numEle+=n}},e.moveTo=function(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)},e.lineTo=function(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))},e.arcTo=function(t,e,i,r,n){var a=0,s=0,o=0,h=this._path._lastOriX-t,l=this._path._lastOriY-e,u=Math.sqrt(h*h+l*l);if(!(u<=1e-6)){var c=h/u,_=l/u,f=i-t,d=r-e,p=f*f+d*d,m=Math.sqrt(p);if(!(m<=1e-6)){var x=f/m,v=d/m,g=c+x,T=_+v,b=Math.sqrt(g*g+T*T);if(!(b<=1e-6)){var y=g/b,A=T/b,E=Math.acos(y*c+A*_),R=Math.PI/2-E,M=(u=n/Math.tan(R))*c+t,S=u*_+e,w=Math.sqrt(u*u+n*n),C=t+y*w,I=e+A*w,P=0,D=0;if(0<=c*v-_*x){var B=2*R/X.SEGNUM;P=Math.sin(B),D=Math.cos(B)}else B=2*-R/X.SEGNUM,P=Math.sin(B),D=Math.cos(B);var O=this._path._lastOriX,L=this._path._lastOriY,F=M,N=S;(.1<Math.abs(F-this._path._lastOriX)||.1<Math.abs(N-this._path._lastOriY))&&(O=s=F,L=o=N,this._path.addPoint(s,o));var U=M-C,V=S-I;for(a=0;a<X.SEGNUM;a++){var k=U*D+V*P,W=-U*P+V*D;s=k+C,o=W+I,(.1<Math.abs(O-s)||.1<Math.abs(L-o))&&(this._path.addPoint(s,o),O=s,L=o),U=k,V=W}}}}},e.arc=function(t,e,i,r,n,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0);var o,h,l=0,u=0,c=0,_=0,f=0,d=0,p=0;if(u=n-r,a)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;var m=this.getMatScaleX(),x=this.getMatScaleY(),v=i*(x<m?m:x),g=2*Math.PI*v;o=u/(h=0|Math.max(g/10,10))/2,c=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),a&&(c=-c);var T=this._getPath();for(p=0;p<=h;p++)l=r+u*(p/h),_=Math.cos(l),d=e+Math.sin(l)*i,(f=t+_*i)==this._path._lastOriX&&d==this._path._lastOriY||T.addPoint(f,d);_=Math.cos(n),d=e+Math.sin(n)*i,(f=t+_*i)==this._path._lastOriX&&d==this._path._lastOriY||T.addPoint(f,d)},e.quadraticCurveTo=function(t,e,i,r){for(var n=h.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,r],30,2),a=0,s=n.length/2;a<s;a++)this.lineTo(n[2*a],n[2*a+1]);this.lineTo(i,r)},e.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new et),this._other.path.rect(t,e,i,r)},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.strokeRect=function(t,e,i,r,n){if(0<this.lineWidth){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),s=this.lineWidth/2;this._fillRect(t-s,e-s,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e-s+r,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e+s,this.lineWidth,r-this.lineWidth,a),this._fillRect(t-s+i,e+s,this.lineWidth,r-this.lineWidth,a)}},e.clip=function(){},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new et)},o(0,e,"globalCompositeOperation",function(){return tt.NAMES[this._nBlendType]},function(t){var e=tt.TOINT[t];null==e||this._nBlendType===e||(I.save(this,65536,this,!0),this._curSubmit=q.RENDERBASE,this._nBlendType=e)}),o(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(I.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=N.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),o(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(I.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),o(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Nt(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),o(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(I.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=N.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),o(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),I.save(this,32768,this._other,!1),this._other.textAlign=t)}),o(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),I.save(this,256,this._other,!1),this._other.lineWidth=t)}),o(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),I.save(this,16384,this._other,!1),this._other.textBaseline=t)}),o(0,e,"font",null,function(t){this._other=this._other.make(),I.save(this,8,this._other,!1)}),o(0,e,"canvas",function(){return this._canvas}),X.__init__=function(){i.DEFAULT=new i},X.set2DRenderConfig=function(){var t=O.instance;Y.setBlend(t,!0),Y.setBlendFunc(t,1,771),Y.setDepthTest(t,!1),Y.setCullFace(t,!1),Y.setDepthMask(t,!0),Y.setFrontFace(t,2305),t.viewport(0,0,ct.width,ct.height)},X._tempPoint=new M,X._SUBMITVBSIZE=32e3,X._MAXSIZE=99999999,X._MAXVERTNUM=65535,X.MAXCLIPRECT=new S(0,0,99999999,99999999),X._COUNT=0,X._tmpMatrix=new R,X.SEGNUM=32,X._contextcount=0,X._clipID_Gen=0,X.defTexture=null,s(X,["_drawStyleTemp",function(){return this._drawStyleTemp=new N(null)},"_keyMap",function(){return this._keyMap=new T},"_drawTexToDrawTri_Vert",function(){return this._drawTexToDrawTri_Vert=new Float32Array(8)},"_drawTexToDrawTri_Index",function(){return this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3])},"_textRender",function(){return this._textRender=new U}]),X.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}l(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},X}(),vt=function(t){function i(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*$.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*$.BYTES_PE],this.color=[4,5126,!1,e,4*$.BYTES_PE]}return l(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",P),i}(),gt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return l(e,"laya.webgl.shader.d2.value.TextureSV",P),e.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(J.shaderHighPrecision?1024:0)},e}(),Tt=function(t){function e(t){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return l(e,"laya.webgl.shader.d2.value.PrimitiveSV",P),e}(),bt=function(t){function e(){e.__super.call(this,laya.webgl.utils.MeshQuadTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=e._maxIB):(this.createQuadIB(e._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}l(e,"laya.webgl.utils.MeshQuadTexture",F);var i=e.prototype;return i.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},i.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},i.addQuad=function(t,e,i,r){var n=this._vb,a=n._byteLength>>2;n.setByteLength(a+laya.webgl.utils.MeshQuadTexture.const_stride<<2);var s=n._floatArray32||n.getFloat32Array(),o=n._uint32Array,h=a,l=r?255:0;s[h++]=t[0],s[h++]=t[1],s[h++]=e[0],s[h++]=e[1],o[h++]=i,o[h++]=l,s[h++]=t[2],s[h++]=t[3],s[h++]=e[2],s[h++]=e[3],o[h++]=i,o[h++]=l,s[h++]=t[4],s[h++]=t[5],s[h++]=e[4],s[h++]=e[5],o[h++]=i,o[h++]=l,s[h++]=t[6],s[h++]=t[7],s[h++]=e[6],s[h++]=e[7],o[h++]=i,o[h++]=l,n._upload=!0},e.getAMesh=function(){return laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new e},e.const_stride=24,e._fixib=null,e._maxIB=16384,e._POOL=[],s(e,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),e}(),yt=function(t){function u(){u.__super.call(this,laya.webgl.utils.MeshVG.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}l(u,"laya.webgl.utils.MeshVG",F);var e=u.prototype;return e.addVertAndIBToMesh=function(t,e,i,r){for(var n=this._vb.needSize(e.length/2*u.const_stride)>>2,a=this._vb._floatArray32||this._vb.getFloat32Array(),s=this._vb._uint32Array,o=0,h=e.length/2,l=0;l<h;l++)a[n++]=e[o],a[n++]=e[o+1],o+=2,s[n++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(r)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=r.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},u.getAMesh=function(){return laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new u},u.const_stride=12,u._POOL=[],s(u,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),u}(),At=function(t){function g(){g.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}l(g,"laya.webgl.utils.MeshTexture",F);var e=g.prototype;return e.addData=function(t,e,i,r,n,a){for(var s=t.length/2,o=this._vb.needSize(s*g.const_stride)>>2,h=this._vb._floatArray32||this._vb.getFloat32Array(),l=this._vb._uint32Array,u=0,c=0;c<s;c++){var _=t[u],f=t[u+1],d=_*r.a+f*r.c+r.tx,p=_*r.b+f*r.d+r.ty;h[o++]=d,h[o++]=p,h[o++]=e[u],h[o++]=e[u+1],u+=2,l[o++]=n,l[o++]=255}this._vb.setNeedUpload();var m=this.vertNum;if(0<m){var x=i.length;x>g.tmpIdx.length&&(g.tmpIdx=new Uint16Array(x));for(var v=0;v<x;v++)g.tmpIdx[v]=i[v]+m;this._ib.appendU16Array(g.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=s,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},g.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new g},g.const_stride=24,g._POOL=[],s(g,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),g}(),Et=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return l(i,"laya.webgl.shader.d2.ShaderDefines2D",k),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024),i.reg("MVP3D",2048)},i.reg=function(t,e){k._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return k._toText(t,e,i)},i.toInt=function(t){return k._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.MVP3D=2048,i.NOOPTMASK=312,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Rt=function(t){function m(t,e,i,r,n){this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,this.maxTexW=0,this.maxTexH=0,this.scaleFontSize=!0,this.showDbgInfo=!1,this.supportImageData=!0,m.__super.call(this),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=!1),this.maxTexW=t,this.maxTexH=e,this.scaleFontSize=i,this.supportImageData=r,this.showDbgInfo=n,m.canvas||((m.canvas=d.document.createElement("canvas")).width=1024,m.canvas.height=512,m.canvas.style.left="-10000px",m.canvas.style.position="absolute",a.body.appendChild(m.canvas),m.ctx=m.canvas.getContext("2d"))}l(m,"laya.webgl.resource.CharRender_Canvas",X);var e=m.prototype;return e.getWidth=function(t,e){return m.ctx?(m.ctx._lastFont!=t&&(m.ctx.font=t,m.ctx._lastFont=t),m.ctx.measureText(e).width):0},e.scale=function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(m.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)},e.getCharBmp=function(t,e,i,r,n,a,s,o,h,l,u){if(!this.supportImageData)return this.getCharCanvas(t,e,i,r,n,a,s,o,h,l);m.ctx.font!=e&&(m.ctx.font=e,m.ctx._lastFont=e),a.width=m.ctx.measureText(t).width;var c=a.width*this.lastScaleX,_=a.height*this.lastScaleY;c+=(s+h)*this.lastScaleX,_+=(o+l)*this.lastScaleY,c=Math.ceil(c),_=Math.ceil(_);var f=(c=Math.min(c,laya.webgl.resource.CharRender_Canvas.canvas.width))+2*i+1,d=(_=Math.min(_,laya.webgl.resource.CharRender_Canvas.canvas.height))+2*i+1;u&&(f=Math.max(f,u[0]+u[2]+1),d=Math.max(d,u[1]+u[3]+1)),m.ctx.clearRect(0,0,f,d),m.ctx.save(),m.ctx.textBaseline="top",0<i&&(m.ctx.strokeStyle=n,m.ctx.lineWidth=i,m.ctx.strokeText(t,s,o)),m.ctx.fillStyle=r,m.ctx.fillText(t,s,o),this.showDbgInfo&&(m.ctx.strokeStyle="#ff0000",m.ctx.strokeRect(0,0,c,_),m.ctx.strokeStyle="#00ff00",m.ctx.strokeRect(s,o,a.width,a.height)),u&&-1==u[2]&&(u[2]=Math.ceil((a.width+2*i)*this.lastScaleX));var p=u?m.ctx.getImageData(u[0],u[1],u[2],u[3]):m.ctx.getImageData(0,0,c,_);return m.ctx.restore(),a.bmpWidth=p.width,a.bmpHeight=p.height,p},e.getCharCanvas=function(t,e,i,r,n,a,s,o,h,l){m.ctx.font!=e&&(m.ctx.font=e,m.ctx._lastFont=e),a.width=m.ctx.measureText(t).width;var u=a.width*this.lastScaleX,c=a.height*this.lastScaleY;return u+=(s+h)*this.lastScaleX,c+=(o+l)*this.lastScaleY+1,u=Math.min(u,this.maxTexW),c=Math.min(c,this.maxTexH),m.canvas.width=Math.min(u+1,this.maxTexW),m.canvas.height=Math.min(c+1,this.maxTexH),m.ctx.font=e,m.ctx.clearRect(0,0,u+1+i,c+1+i),m.ctx.setTransform(1,0,0,1,0,0),m.ctx.save(),this.scaleFontSize&&m.ctx.scale(this.lastScaleX,this.lastScaleY),m.ctx.translate(s,o),m.ctx.textAlign="left",m.ctx.textBaseline="top",0<i?(m.ctx.strokeStyle=n,m.ctx.fillStyle=r,m.ctx.lineWidth=i,m.ctx.fillAndStrokeText?m.ctx.fillAndStrokeText(t,0,0):(m.ctx.strokeText(t,0,0),m.ctx.fillText(t,0,0))):(m.ctx.fillStyle=r,m.ctx.fillText(t,0,0)),this.showDbgInfo&&(m.ctx.strokeStyle="#ff0000",m.ctx.strokeRect(0,0,u,c),m.ctx.strokeStyle="#00ff00",m.ctx.strokeRect(0,0,a.width,a.height)),m.ctx.restore(),a.bmpWidth=m.canvas.width,a.bmpHeight=m.canvas.height,m.canvas},o(0,e,"canvasWidth",function(){return m.canvas.width},function(t){m.canvas.width!=t&&(2048<(m.canvas.width=t)&&console.warn("画文字设置的宽度太大，超过2048了"),m.ctx.setTransform(1,0,0,1,0,0),m.ctx.scale(this.lastScaleX,this.lastScaleY))}),m.canvas=null,m.ctx=null,m}(),Mt=function(t){function e(){e.__super.call(this)}return l(e,"laya.webgl.BufferState2D",H),e}(),St=function(t){function e(){this.lastFont="",e.__super.call(this)}l(e,"laya.webgl.resource.CharRender_Native",X);var i=e.prototype;return i.getWidth=function(t,e){return d.conchTextCanvas?(d.conchTextCanvas.font=t,this.lastFont=t,d.conchTextCanvas.measureText(e).width):0},i.scale=function(t,e){},i.getCharBmp=function(t,e,i,r,n,a,s,o,h,l,u){if(!d.conchTextCanvas)return null;d.conchTextCanvas.font=e,this.lastFont=e;a.width=d.conchTextCanvas.measureText(t).width,a.height;var c=p.create(n).numColor,_=p.create(r).numColor,f=d.conchTextCanvas.getTextBitmapData(t,_,2<i?2:i,c);return a.bmpWidth=f.width,a.bmpHeight=f.height,f},e}(),wt=function(t){function a(){this._matrix=new R,this._matrix4=$.defaultMatrix4.concat(),a.__super.call(this,1e4),this.shaderValue=new P(0,0)}l(a,"laya.webgl.submit.SubmitCanvas",q);var e=a.prototype;return e.renderSubmit=function(){var t=ct.worldAlpha,e=ct.worldMatrix4,i=ct.worldMatrix,r=ct.worldFilters,n=ct.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,h=R.TEMP;return R.mul(s,i,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,ct.worldMatrix=h.clone(),ct.worldMatrix4=o,ct.worldAlpha=ct.worldAlpha*a.alpha,a.filters&&a.filters.length&&(ct.worldFilters=a.filters,ct.worldShaderDefines=a.defines),this.canv.flushsubmit(),ct.worldAlpha=t,ct.worldMatrix4=e,ct.worldMatrix.destroy(),ct.worldMatrix=i,ct.worldFilters=r,ct.worldShaderDefines=n,1},e.releaseRender=function(){if(--this._ref<1){var t=a.POOL;this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,i){return null},e.getRenderType=function(){return 10003},a.create=function(t,e,i){var r=a.POOL._length?a.POOL[--a.POOL._length]:new a;r.canv=t,r._ref=1,r._numEle=0;var n=r.shaderValue;return n.alpha=e,n.defines.setValue(0),i&&i.length&&n.setFilters(i),r},a.POOL=((a.POOL=[])._length=0,a.POOL),a}(),Ct=(function(t){function i(t){i.__super.call(this,laya.webgl.utils.MeshParticle2D.const_stride,4*t*i.const_stride,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}l(i,"laya.webgl.utils.MeshParticle2D",F);var e=i.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*i.const_stride,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},i.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new i(t)},i.const_stride=116,i._POOL=[],s(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this)}l(e,"laya.webgl.utils.Buffer2D",it);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),g.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,O.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),O.instance.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),g.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,O.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||i){var r=this._buffer.slice(e,i);O.instance.bufferSubData(this._bufferType,t,r)}else O.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t),r=this._u8Array&&this._u8Array.buffer==this._buffer?this._u8Array:new Uint8Array(this._buffer);this._u8Array=new Uint8Array(i),this._u8Array.set(r,0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this._bufferSize=this._buffer.byteLength,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;var n,a;n=i*r,this._resizeBuffer(this._byteLength+n,!0),a=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)a[s]=t[s];this._byteLength+=n,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return O.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(it._bindedVertexBuffer=null),34963==this._bufferType&&(it._bindedIndexBuffer=null),Pt.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=this._bind_subUpload();return O.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(it._bindedVertexBuffer=null),34963==this._bufferType&&(it._bindedIndexBuffer=null),Pt.activeShader=null,r},i._disposeResource=function(){this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},o(0,i,"bufferLength",function(){return this._buffer.byteLength}),o(0,i,"byteLength",null,function(t){this.setByteLength(t)}),e.__int__=function(t){},e.FLOAT32=4,e.SHORT=2,e}()),It=function(t){function s(t){void 0===t&&(t=1e4),s.__super.call(this,t)}l(s,"laya.webgl.submit.SubmitTexture",q);var e=s.prototype;return e.clone=function(t,e,i){var r=s._poolSize?s.POOL[--s._poolSize]:new s;return this._cloneInit(r,t,e,i),r},e.releaseRender=function(){--this._ref<1&&((s.POOL[s._poolSize++]=this).shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=J.mainContext;this._mesh.useMesh(i);var r=q.preRender,n=q.preRender._key;return 0===this._key.blendShader&&this._key.submitType===n.submitType&&this._key.blendShader===n.blendShader&&Pt.activeShader&&q.preRender.clipInfoID==this.clipInfoID&&r.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&Et.NOOPTMASK)?Pt.activeShader.uploadTexture2D(e):(tt.activeBlendFunction!==this._blendFn&&(Y.setBlend(i,!0),this._blendFn(i),tt.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),g.renderBatch++,g.trianglesFaces+=this._numEle/3,1},s.create=function(t,e,i){var r=s._poolSize?s.POOL[--s._poolSize]:new s(10016);r._mesh=e,r._key.clear(),r._key.submitType=2,r._ref=1,r._startIdx=e.indexNum*$.BYTES_PIDX,r._numEle=0;var n=t._nBlendType;if(r._key.blendShader=n,r._blendFn=t._targets?tt.targetFns[n]:tt.fns[n],r.shaderValue=i,t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return r},s._poolSize=0,s.POOL=[],s}(),Pt=function(t){function e(){e.__super.call(this)}return l(e,"laya.webgl.shader.BaseShader",i),e.activeShader=null,e.bindShader=null,e}(),Dt=function(t){function r(t,e){this._source=null,this._texW=0,this._texH=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.bitmap={id:0,_glTexture:null},this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=0,this.ri=null,r.__super.call(this),this._texW=t||U.atlasWidth,this._texH=e||U.atlasWidth,this.bitmap.id=this.id,this.lock=!0}l(r,"laya.webgl.text.TextTexture",i);var e=r.prototype;return e.recreateResource=function(){if(!this._source){var t=C.isConchApp?O.instance.getDefaultCommandEncoder():J.mainContext,e=this._source=t.createTexture();this.bitmap._glTexture=e,Y.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),U.debugUV&&this.fillWhite()}},e.addChar=function(t,e,i,r){if(U.isWan1Wan)return this.addCharCanvas(t,e,i,r);!this._source&&this.recreateResource();var n=C.isConchApp?O.instance.getDefaultCommandEncoder():J.mainContext;Y.bindTexture(n,3553,this._source),!C.isConchApp&&n.pixelStorei(37441,!0);var a=t.data;t.data instanceof Uint8ClampedArray&&(a=new Uint8Array(a.buffer)),n.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,a),!C.isConchApp&&n.pixelStorei(37441,!1);var s=NaN,o=NaN,h=NaN,l=NaN;return l=C.isConchApp?(s=e/this._texW,o=i/this._texH,h=(e+t.width)/this._texW,(i+t.height)/this._texH):(s=(e+1)/this._texW,o=i/this._texH,h=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=s,r[1]=o,r[2]=h,r[3]=o,r[4]=h,r[5]=l,r[6]=s,r[7]=l,r},e.addCharCanvas=function(t,e,i,r){!this._source&&this.recreateResource();var n=C.isConchApp?O.instance.getDefaultCommandEncoder():J.mainContext;Y.bindTexture(n,3553,this._source),!C.isConchApp&&n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t),!C.isConchApp&&n.pixelStorei(37441,!1);var a=NaN,s=NaN,o=NaN,h=NaN;return h=C.isConchApp?(a=e/this._texW,s=i/this._texH,o=(e+t.width)/this._texW,(i+t.height)/this._texH):(a=(e+1)/this._texW,s=(i+1)/this._texH,o=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=a,r[1]=s,r[2]=o,r[3]=s,r[4]=o,r[5]=h,r[6]=a,r[7]=h,r},e.fillWhite=function(){!this._source&&this.recreateResource();var t=C.isConchApp?O.instance.getDefaultCommandEncoder():J.mainContext,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)},e.discard=function(){this._texW==U.atlasWidth&&this._texH==U.atlasWidth?(this.genID++,r.poolLen>=r.pool.length&&(r.pool=r.pool.concat(new Array(10))),this._discardTm=y.stage.getFrameTm(),r.pool[r.poolLen++]=this):this.destroy()},e.destroy=function(){console.log("destroy TextTexture"),this.__destroyed=!0;var t=C.isConchApp?O.instance.getDefaultCommandEncoder():J.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e.touchRect=function(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var i=U.atlasWidth*U.atlasWidth,r=pt.atlasGridW*pt.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/pt.atlasGridW)*Math.ceil(t.bmpHeight/pt.atlasGridW)/(i/r)},e._getSource=function(){return this._source},e.drawOnScreen=function(t,e){},o(0,e,"texture",function(){return this}),r.getTextTexture=function(t,e){if(t!=U.atlasWidth||t!=U.atlasWidth)return new r(t,e);if(0<r.poolLen){var i=r.pool[--r.poolLen];return 0<r.poolLen&&r.clean(),i}return new r(t,e)},r.clean=function(){var t=y.stage.getFrameTm();if(0===r.cleanTm&&(r.cleanTm=t),t-r.cleanTm>=U.checkCleanTextureDt){for(var e=0;e<r.poolLen;e++){var i=r.pool[e];t-i._discardTm>=U.destroyUnusedTextureDt&&(i.destroy(),r.pool[e]=r.pool[r.poolLen-1],r.poolLen--,e--)}r.cleanTm=t}},r.poolLen=0,r.cleanTm=0,s(r,["pool",function(){return this.pool=new Array(10)}]),r}(),Bt=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}l(e,"laya.webgl.utils.IndexBuffer2D",Ct);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i._bindForVAO=function(){O.instance.bindBuffer(34963,this._glBuffer)},i.bind=function(){return it._bindedIndexBuffer!==this._glBuffer&&(O.instance.bindBuffer(34963,this._glBuffer),it._bindedIndexBuffer=this._glBuffer,!0)},i.destory=function(){this._uint16Array=null,this._buffer=null},i.disposeResource=function(){this._disposeResource()},e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),Ot=function(t){function i(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}l(i,"laya.webgl.utils.VertexBuffer2D",Ct);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){O.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return it._bindedVertexBuffer!==this._glBuffer&&(O.instance.bindBuffer(34962,this._glBuffer),it._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},o(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}(),Lt=function(t){function i(t,e){i.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=O.instance.createTexture()}l(i,"laya.webgl.resource.BaseTexture",r);var e=i.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!Y._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=Y._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!Y._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=Y._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!Y._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=Y._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!Y._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=Y._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!Y._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=Y._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!Y._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=Y._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!Y._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=Y._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=O.instance;switch(Y.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap&&this._isPot(this._width)&&this._isPot(this._height)?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var i=O.instance;if(Y.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){var e=Y._extTextureFilterAnisotropic;if(e&&!u.onLimixiu){t=Math.max(t,1);var i=O.instance;Y.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},e._disposeResource=function(){this._glTexture&&(O.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},o(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),o(0,e,"mipmap",function(){return this._mipmap}),o(0,e,"format",function(){return this._format}),o(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),o(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),o(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),o(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),i.WARPMODE_REPEAT=0,i.WARPMODE_CLAMP=1,i.FILTERMODE_POINT=0,i.FILTERMODE_BILINEAR=1,i.FILTERMODE_TRILINEAR=2,i.FORMAT_R8G8B8=0,i.FORMAT_R8G8B8A8=1,i.FORMAT_ALPHA8=2,i.FORMAT_DXT1=3,i.FORMAT_DXT5=4,i.FORMAT_ETC1RGB=5,i.FORMAT_PVRTCRGB_2BPPV=9,i.FORMAT_PVRTCRGBA_2BPPV=10,i.FORMAT_PVRTCRGB_4BPPV=11,i.FORMAT_PVRTCRGBA_4BPPV=12,i.FORMAT_DEPTH_16=0,i.FORMAT_STENCIL_8=1,i.FORMAT_DEPTHSTENCIL_16_8=2,i.FORMAT_DEPTHSTENCIL_NONE=3,i}(),Ft=function(t){function h(t,e,i,r,n){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},h.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=n,this._id=++h._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(h.sharders[i]=this),this.recreateResource(),this.lock=!0}l(h,"laya.webgl.shader.Shader",Pt);var e=h.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){J.mainContext.deleteShader(this._vshader),J.mainContext.deleteShader(this._pshader),J.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=z.preGetParams(this._vs,this._ps));var e=J.mainContext;this._program=e.createProgram(),this._vshader=h._createShader(e,this._vs,35633),this._pshader=h._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var i,r,n=0,a=this._attribInfo?this._attribInfo.length:0;for(n=0;n<a;n+=2)e.bindAttribLocation(this._program,this._attribInfo[n+1],this._attribInfo[n]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var s=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(n=0;n<s;n++){var o=this.customCompile?t.uniforms[n]:e.getActiveUniform(this._program,n);0<(i={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(n=0,r=this._params.length;n<r;n++)switch((i=this._params[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(J.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(J.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return J.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(J.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(J.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return J.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(J.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return J.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(J.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return J.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return J.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return J.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return J.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(J.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return J.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(J.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return J.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(J.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return J.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(J.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return J.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=J.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),Y.activeTexture(i,33984+this._curActTexIndex),Y.bindTexture(i,3553,e),this._curActTexIndex++,1):(Y.activeTexture(i,33984+r[0]),Y.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=J.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),Y.activeTexture(i,33984+this._curActTexIndex),Y.bindTexture(i,34067,e),this._curActTexIndex++,1):(Y.activeTexture(i,33984+r[0]),Y.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){Y.useProgram(J.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){var e=Y;e._activeTextures[0]!==t&&(e.bindTexture(J.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){Pt.activeShader=Pt.bindShader=this;var i=J.mainContext;Y.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var r,n,a=e.length,s=0,o=0;o<a;o++)null!==(n=t[(r=e[o]).name])&&(s+=r.fun.call(this,r,n));g.shaderCall+=s},e.uploadArray=function(t,e,i){Pt.activeShader=this,Pt.bindShader=this,Y.useProgram(J.mainContext,this._program);this._params;for(var r,n,a=0,s=e-2;0<=s;s-=2)(n=this._paramsMap[t[s]])&&null!=(r=t[s+1])&&(i&&i[n.name]&&i[n.name].bind(),a+=n.fun.call(this,n,r));g.shaderCall+=a},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},h.getShader=function(t){return h.sharders[t]},h.create=function(t,e,i,r,n){return new h(t,e,i,r,n)},h.withCompile=function(t,e,i,r){if(i&&h.sharders[i])return h.sharders[i];var n=h._preCompileShader[2e-4*t];if(!n)throw new Error("withCompile shader err!"+t);return n.createShader(e,i,r,null)},h.withCompile2D=function(t,e,i,r,n,a){if(r&&h.sharders[r])return h.sharders[r];var s=h._preCompileShader[2e-4*t+e];if(!s)throw new Error("withCompile shader err!"+t+" "+e);return s.createShader(i,r,n,a)},h.addInclude=function(t,e){z.addInclude(t,e)},h.preCompile=function(t,e,i,r){h._preCompileShader[2e-4*t]=new z(e,i,r)},h.preCompile2D=function(t,e,i,r,n){h._preCompileShader[2e-4*t+e]=new z(i,r,n)},h._createShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,35713)?r:(console.log(t.getShaderInfoLog(r)),null)},h._count=0,h._preCompileShader={},h.SHADERNAME2ID=2e-4,h.sharders=new Array(32),s(h,["nameKey",function(){return this.nameKey=new T}]),h}(),Nt=function(t){function n(t,e,i,r){void(this._mgrKey=0)===i&&(i=0),void 0===r&&(r=0),n.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=r,this._create(t,e)}l(n,"laya.webgl.resource.RenderTexture2D",Lt);var e=n.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var i=O.instance;this._frameBuffer=i.createFramebuffer(),Y.bindTexture(i,this._glTextureType,this._glTexture);var r=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,r,t,e,0,r,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,O.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=O.instance;O.instance.bindFramebuffer(36160,this._frameBuffer),this._lastRT=n._currentActive,(n._currentActive=this)._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=ct.width,this._lastHeight=ct.height,ct.width=this._width,ct.height=this._height,Pt.activeShader=null},e.end=function(){O.instance.bindFramebuffer(36160,null),n._currentActive=null,this._readyed=!0},e.restore=function(){var t=O.instance;this._lastRT!=n._currentActive&&(O.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),n._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),ct.width=this._lastWidth,ct.height=this._lastHeight,Pt.activeShader=null},e.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1);var n=O.instance;n.clearColor(t,e,i,r);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}n.clear(a)},e.getData=function(t,e,i,r){var n=O.instance;if(n.bindFramebuffer(36160,this._frameBuffer),!(36053===n.checkFramebufferStatus(36160)))return n.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4),s=this._getGLFormat();return n.readPixels(t,e,i,r,s,5121,a),n.bindFramebuffer(36160,null),a},e.recycle=function(){},e._disposeResource=function(){if(this._frameBuffer){var t=O.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},o(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),o(0,e,"defaulteTexture",function(){return Ut.grayTexture}),o(0,e,"sourceWidth",function(){return this._width}),o(0,e,"sourceHeight",function(){return this._height}),o(0,e,"offsetX",function(){return 0}),o(0,e,"offsetY",function(){return 0}),o(1,n,"currentActive",function(){return n._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),n.pushRT=function(){n.rtStack.push({rt:n._currentActive,w:ct.width,h:ct.height})},n.popRT=function(){var t=O.instance,e=n.rtStack.pop();e&&(n._currentActive!=e.rt&&(O.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),n._currentActive=e.rt),t.viewport(0,0,e.w,e.h),ct.width=e.w,ct.height=e.h)},n._currentActive=null,n.rtStack=[],s(n,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),n}(),Ut=function(t){function a(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=!0),void 0===n&&(n=!1),a.__super.call(this,i,r),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=n,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),c.is2DPixelArtGame&&(this._filterMode=0),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel)}l(a,"laya.webgl.resource.Texture2D",Lt);var e=a.prototype;return e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case 3:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var r=1;if(131072&e[2]){if(r=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var n=e[4],a=e[3];this._width=n,this._height=a;var s=e[1]+4;this._upLoadCompressedTexImage2D(t,n,a,r,s,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13);switch(i[4]){case Y._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format."}var r=i[11],n=i[6],a=i[7];this._width=n,this._height=a;var s=64+i[12];this._upLoadCompressedTexImage2D(t,n,a,r,s,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";switch(e[2]){case 0:this._format=9;break;case 2:this._format=11;break;case 1:this._format=10;break;case 3:this._format=12;break;default:throw"Texture2D:unknown PVR format."}var i=e[11],r=e[7],n=e[6];this._width=r,this._height=n;var a=e[12]+52;this._upLoadCompressedTexImage2D(t,r,n,i,a,0)},e._upLoadCompressedTexImage2D=function(t,e,i,r,n,a){var s=O.instance,o=this._glTextureType;Y.bindTexture(s,o,this._glTexture);for(var h=this._getGLFormat(),l=n,u=0;u<r;u++){l+=a;var c=this._calcualatesCompressedDataSize(this._format,e,i),_=new Uint8Array(t,l,c);s.compressedTexImage2D(o,u,h,e,i,0,_),e=Math.max(e>>1,1),i=Math.max(i>>1,1),l+=c}var f=l;this._setGPUMemory(f),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,r=t.height;this._width=i,this._height=r,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var n=O.instance;Y.bindTexture(n,this._glTextureType,this._glTexture);var a=this._getGLFormat();C.isConchApp?(t.setPremultiplyAlpha(e),n.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&n.pixelStorei(37441,!0),n.texImage2D(this._glTextureType,0,a,a,5121,t),e&&n.pixelStorei(37441,!1)),this._mipmap&&this._isPot(i)&&this._isPot(r)?(n.generateMipmap(this._glTextureType),this._setGPUMemory(i*r*4*(1+1/3))):this._setGPUMemory(i*r*4),this._canRead&&(C.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,r)):(u.canvas.size(i,r),u.canvas.clear(),u.context.drawImage(t,0,0,i,r),this._pixels=new Uint8Array(u.context.getImageData(0,0,i,r).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=this._width,r=this._height,n=O.instance,a=this._glTextureType;Y.bindTexture(n,a,this._glTexture);var s=this._getGLFormat();n.texImage2D(a,e,s,i,r,0,s,5121,t),this._mipmap&&this._isPot(i)&&this._isPot(r)?(n.generateMipmap(a),this._setGPUMemory(i*r*4*(1+1/3))):this._setGPUMemory(i*r*4),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},o(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),a.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,(a.grayTexture=new a(1,1,0,!1,!1)).setPixels(t),a.grayTexture.lock=!0},a._parse=function(t,e,i){var r=i?new a(i[0],i[1],i[2],i[3],i[4]):new a(0,0);switch(e&&(r.wrapModeU=e.wrapModeU,r.wrapModeV=e.wrapModeV,r.filterMode=e.filterMode,r.anisoLevel=e.anisoLevel),r._format){case 0:case 1:r.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:r.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return r},a.load=function(t,e){y.loader.create(t,e,null,"TEXTURE2D")},a.grayTexture=null,a}(),Vt=function(t){function a(t,e,i,r,n){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,a.__super.call(this,t,e,i,r,n)}l(a,"laya.webgl.shader.d2.Shader2X",t);var e=a.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},a.create=function(t,e,i,r,n){return new a(t,e,i,r,n)},a}(Ft);y.__init([et,xt])}(window,document,Laya);